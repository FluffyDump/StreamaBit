2024-11-07 00:09:03.412 | INFO     | app.services.user_service:remove_user:121 - 
REMOVING USER ACCOUNT
2024-11-07 00:09:03.413 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:29 - Validating input
2024-11-07 00:09:03.414 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:60 - Input passed validation
2024-11-07 00:09:03.414 | INFO     | app.validators.user_validator:validate_username:17 - Validating username format
2024-11-07 00:09:03.415 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:29 - Validating input
2024-11-07 00:09:03.415 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:60 - Input passed validation
2024-11-07 00:09:03.416 | INFO     | app.validators.shared_validator:letters_numbers_only:17 - Validating input
2024-11-07 00:09:03.417 | INFO     | app.validators.shared_validator:letters_numbers_only:23 - Input passed validation
2024-11-07 00:09:03.417 | INFO     | app.validators.user_validator:validate_username:31 - Username validation passed
2024-11-07 00:09:03.417 | INFO     | app.validators.user_validator:validate_email:39 - Validating email format
2024-11-07 00:09:03.417 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:29 - Validating input
2024-11-07 00:09:03.417 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:60 - Input passed validation
2024-11-07 00:09:03.418 | INFO     | app.validators.user_validator:validate_email:54 - Email validation passed
2024-11-07 00:09:03.418 | INFO     | app.validators.user_validator:validate_password:62 - Validating password format
2024-11-07 00:09:03.418 | INFO     | app.validators.user_validator:validate_password:89 - Password validation passed
2024-11-07 00:09:03.419 | INFO     | app.crud.user_crud:get_authenticated_user:52 - Searching for user by specified username, email and password_hash
2024-11-07 00:09:03.440 | INFO     | app.crud.user_crud:get_authenticated_user:56 - User found
2024-11-07 00:09:03.462 | ERROR    | app.services.user_service:remove_user:142 - 
USER ACCOUNT HAS NOT BEEN REMOVED, EXCEPTION OCCURED: (psycopg2.errors.NotNullViolation) null value in column "fk_user_id" of relation "user_session" violates not-null constraint
DETAIL:  Failing row contains (15, 2024-11-06 13:16:04.68704+02, 127.0.0.1, null).

[SQL: UPDATE user_session SET fk_user_id=%(fk_user_id)s WHERE user_session.session_id = %(user_session_session_id)s]
[parameters: {'fk_user_id': None, 'user_session_session_id': 15}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):

  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x0000013A25C9C360>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x0000013A26064950>
    └ <sqlalchemy.engine.base.Connection object at 0x0000013A2784F550>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\engine\default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'fk_user_id': None, 'user_session_session_id': 15}
    │      │       └ 'UPDATE user_session SET fk_user_id=%(fk_user_id)s WHERE user_session.session_id = %(user_session_session_id)s'
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x0000013A2787BBC0; closed: -1>

psycopg2.errors.NotNullViolation: null value in column "fk_user_id" of relation "user_session" violates not-null constraint
DETAIL:  Failing row contains (15, 2024-11-06 13:16:04.68704+02, 127.0.0.1, null).



The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\threading.py", line 1002, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x0000013A21F64860>
    └ <WorkerThread(AnyIO worker thread, started 33696)>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\threading.py", line 1045, in _bootstrap_inner
    self.run()
    │    └ <function WorkerThread.run at 0x0000013A2776C400>
    └ <WorkerThread(AnyIO worker thread, started 33696)>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\anyio\_backends\_asyncio.py", line 914, in run
    result = context.run(func, *args)
             │       │   │      └ ()
             │       │   └ functools.partial(<function delete_user at 0x0000013A276C2660>, db=<sqlalchemy.orm.session.Session object at 0x0000013A277178...
             │       └ <method 'run' of '_contextvars.Context' objects>
             └ <_contextvars.Context object at 0x0000013A276C7D40>

  File "C:\Users\tomas\Documents\Saityno Progr. Projektavimas\StreamaBit\app\main.py", line 61, in delete_user
    return user_services.remove_user(db=db, username=username, data=data)
           │             │              │            │              └ UserDelete(email='firstUser55@gmail.com', password='Password1234$')
           │             │              │            └ 'First55Select'
           │             │              └ <sqlalchemy.orm.session.Session object at 0x0000013A27717850>
           │             └ <function remove_user at 0x0000013A2734EC00>
           └ <module 'app.services.user_service' from 'C:\\Users\\tomas\\Documents\\Saityno Progr. Projektavimas\\StreamaBit\\app\\service...

> File "C:\Users\tomas\Documents\Saityno Progr. Projektavimas\StreamaBit\app\services\user_service.py", line 138, in remove_user
    shared_crud.commit(db)
    │           │      └ <sqlalchemy.orm.session.Session object at 0x0000013A27717850>
    │           └ <function commit at 0x0000013A2734EA20>
    └ <module 'app.crud.shared_crud' from 'C:\\Users\\tomas\\Documents\\Saityno Progr. Projektavimas\\StreamaBit\\app\\crud\\shared...

  File "C:\Users\tomas\Documents\Saityno Progr. Projektavimas\StreamaBit\app\crud\shared_crud.py", line 7, in commit
    return db.commit()
           │  └ <function Session.commit at 0x0000013A25F699E0>
           └ <sqlalchemy.orm.session.Session object at 0x0000013A27717850>

  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\session.py", line 2028, in commit
    trans.commit(_to_root=True)
    │     └ <function SessionTransaction.commit at 0x0000013A25F68AE0>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x0000013A262975C0>
  File "<string>", line 2, in commit
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                │  │      │      └ {'_to_root': True}
                │  │      └ ()
                │  └ <sqlalchemy.orm.session.SessionTransaction object at 0x0000013A262975C0>
                └ <function SessionTransaction.commit at 0x0000013A25F68900>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\session.py", line 1313, in commit
    self._prepare_impl()
    │    └ <function SessionTransaction._prepare_impl at 0x0000013A25F687C0>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x0000013A262975C0>
  File "<string>", line 2, in _prepare_impl
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                │  │      │      └ {}
                │  │      └ ()
                │  └ <sqlalchemy.orm.session.SessionTransaction object at 0x0000013A262975C0>
                └ <function SessionTransaction._prepare_impl at 0x0000013A25F68720>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\session.py", line 1288, in _prepare_impl
    self.session.flush()
    │    │       └ <function Session.flush at 0x0000013A25F74900>
    │    └ <sqlalchemy.orm.session.Session object at 0x0000013A27717850>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x0000013A262975C0>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\session.py", line 4352, in flush
    self._flush(objects)
    │    │      └ None
    │    └ <function Session._flush at 0x0000013A25F74AE0>
    └ <sqlalchemy.orm.session.Session object at 0x0000013A27717850>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\session.py", line 4487, in _flush
    with util.safe_reraise():
         │    └ <class 'sqlalchemy.util.langhelpers.safe_reraise'>
         └ <module 'sqlalchemy.util' from 'C:\\Users\\tomas\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\site-packages\\sqlalchemy...
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
          │         │              └ <traceback object at 0x0000013A278BF400>
          │         └ <method 'with_traceback' of 'BaseException' objects>
          └ IntegrityError('(psycopg2.errors.NotNullViolation) null value in column "fk_user_id" of relation "user_session" violates not-...
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\session.py", line 4448, in _flush
    flush_context.execute()
    │             └ <function UOWTransaction.execute at 0x0000013A25F593A0>
    └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x0000013A2785FF50>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
    │   │       └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x0000013A2785FF50>
    │   └ <function SaveUpdateAll.execute at 0x0000013A25F59EE0>
    └ SaveUpdateAll(Mapper[UserSession(user_session)])
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    │    │         │               └ <function save_obj at 0x0000013A25F05A80>
    │    │         └ <module 'sqlalchemy.orm.persistence' from 'C:\\Users\\tomas\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\site-packages\...
    │    └ <module 'sqlalchemy.util.preloaded' from 'C:\\Users\\tomas\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\site-packages\\...
    └ <module 'sqlalchemy.util' from 'C:\\Users\\tomas\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\site-packages\\sqlalchemy...
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\persistence.py", line 85, in save_obj
    _emit_update_statements(
    └ <function _emit_update_statements at 0x0000013A25F500E0>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\persistence.py", line 912, in _emit_update_statements
    c = connection.execute(
        │          └ <function Connection.execute at 0x0000013A25BD8360>
        └ <sqlalchemy.engine.base.Connection object at 0x0000013A2784F550>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\engine\base.py", line 1418, in execute
    return meth(
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.dml.Update object at 0x0000013A278BE8D0>>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\sql\elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x0000013A25BD8680>
           └ <sqlalchemy.engine.base.Connection object at 0x0000013A2784F550>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\engine\base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x0000013A25BD8860>
          └ <sqlalchemy.engine.base.Connection object at 0x0000013A2784F550>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\engine\base.py", line 1846, in _execute_context
    return self._exec_single_context(
           │    └ <function Connection._exec_single_context at 0x0000013A25BD8900>
           └ <sqlalchemy.engine.base.Connection object at 0x0000013A2784F550>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\engine\base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x0000013A25BD8B80>
    └ <sqlalchemy.engine.base.Connection object at 0x0000013A2784F550>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\engine\base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
          │                    │              │                 └ NotNullViolation('null value in column "fk_user_id" of relation "user_session" violates not-null constraint\nDETAIL:  Failing...
          │                    │              └ (<class 'psycopg2.errors.NotNullViolation'>, NotNullViolation('null value in column "fk_user_id" of relation "user_session" v...
          │                    └ <method 'with_traceback' of 'BaseException' objects>
          └ IntegrityError('(psycopg2.errors.NotNullViolation) null value in column "fk_user_id" of relation "user_session" violates not-...
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x0000013A25C9C360>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x0000013A26064950>
    └ <sqlalchemy.engine.base.Connection object at 0x0000013A2784F550>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\engine\default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'fk_user_id': None, 'user_session_session_id': 15}
    │      │       └ 'UPDATE user_session SET fk_user_id=%(fk_user_id)s WHERE user_session.session_id = %(user_session_session_id)s'
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x0000013A2787BBC0; closed: -1>

sqlalchemy.exc.IntegrityError: (psycopg2.errors.NotNullViolation) null value in column "fk_user_id" of relation "user_session" violates not-null constraint
DETAIL:  Failing row contains (15, 2024-11-06 13:16:04.68704+02, 127.0.0.1, null).

[SQL: UPDATE user_session SET fk_user_id=%(fk_user_id)s WHERE user_session.session_id = %(user_session_session_id)s]
[parameters: {'fk_user_id': None, 'user_session_session_id': 15}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2024-11-07 00:10:29.945 | INFO     | app.services.user_service:remove_user:121 - 
REMOVING USER ACCOUNT
2024-11-07 00:10:29.946 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:29 - Validating input
2024-11-07 00:10:29.947 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:60 - Input passed validation
2024-11-07 00:10:29.947 | INFO     | app.validators.user_validator:validate_username:17 - Validating username format
2024-11-07 00:10:29.947 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:29 - Validating input
2024-11-07 00:10:29.947 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:60 - Input passed validation
2024-11-07 00:10:29.947 | INFO     | app.validators.shared_validator:letters_numbers_only:17 - Validating input
2024-11-07 00:10:29.948 | INFO     | app.validators.shared_validator:letters_numbers_only:23 - Input passed validation
2024-11-07 00:10:29.948 | INFO     | app.validators.user_validator:validate_username:31 - Username validation passed
2024-11-07 00:10:29.948 | INFO     | app.validators.user_validator:validate_email:39 - Validating email format
2024-11-07 00:10:29.948 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:29 - Validating input
2024-11-07 00:10:29.949 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:60 - Input passed validation
2024-11-07 00:10:29.949 | INFO     | app.validators.user_validator:validate_email:54 - Email validation passed
2024-11-07 00:10:29.949 | INFO     | app.validators.user_validator:validate_password:62 - Validating password format
2024-11-07 00:10:29.949 | INFO     | app.validators.user_validator:validate_password:89 - Password validation passed
2024-11-07 00:10:29.949 | INFO     | app.crud.user_crud:get_authenticated_user:52 - Searching for user by specified username, email and password_hash
2024-11-07 00:10:29.973 | INFO     | app.crud.user_crud:get_authenticated_user:56 - User found
2024-11-07 00:10:30.008 | ERROR    | app.services.user_service:remove_user:142 - 
USER ACCOUNT HAS NOT BEEN REMOVED, EXCEPTION OCCURED: (psycopg2.errors.NotNullViolation) null value in column "fk_user_id" of relation "user_session" violates not-null constraint
DETAIL:  Failing row contains (15, 2024-11-06 13:16:04.68704+02, 127.0.0.1, null).

[SQL: UPDATE user_session SET fk_user_id=%(fk_user_id)s WHERE user_session.session_id = %(user_session_session_id)s]
[parameters: {'fk_user_id': None, 'user_session_session_id': 15}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):

  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x00000142689EC360>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x0000014268DB4510>
    └ <sqlalchemy.engine.base.Connection object at 0x000001426A59F010>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\engine\default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'fk_user_id': None, 'user_session_session_id': 15}
    │      │       └ 'UPDATE user_session SET fk_user_id=%(fk_user_id)s WHERE user_session.session_id = %(user_session_session_id)s'
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x000001426A5CFBC0; closed: -1>

psycopg2.errors.NotNullViolation: null value in column "fk_user_id" of relation "user_session" violates not-null constraint
DETAIL:  Failing row contains (15, 2024-11-06 13:16:04.68704+02, 127.0.0.1, null).



The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\threading.py", line 1002, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x0000014264C44860>
    └ <WorkerThread(AnyIO worker thread, started 21952)>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\threading.py", line 1045, in _bootstrap_inner
    self.run()
    │    └ <function WorkerThread.run at 0x000001426A4B8400>
    └ <WorkerThread(AnyIO worker thread, started 21952)>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\anyio\_backends\_asyncio.py", line 914, in run
    result = context.run(func, *args)
             │       │   │      └ ()
             │       │   └ functools.partial(<function delete_user at 0x000001426A412660>, db=<sqlalchemy.orm.session.Session object at 0x0000014268F007...
             │       └ <method 'run' of '_contextvars.Context' objects>
             └ <_contextvars.Context object at 0x000001426A459300>

  File "C:\Users\tomas\Documents\Saityno Progr. Projektavimas\StreamaBit\app\main.py", line 61, in delete_user
    return user_services.remove_user(db=db, username=username, data=data)
           │             │              │            │              └ UserDelete(email='firstUser55@gmail.com', password='Password1234$')
           │             │              │            └ 'First55Select'
           │             │              └ <sqlalchemy.orm.session.Session object at 0x0000014268F007D0>
           │             └ <function remove_user at 0x00000142690CEC00>
           └ <module 'app.services.user_service' from 'C:\\Users\\tomas\\Documents\\Saityno Progr. Projektavimas\\StreamaBit\\app\\service...

> File "C:\Users\tomas\Documents\Saityno Progr. Projektavimas\StreamaBit\app\services\user_service.py", line 138, in remove_user
    shared_crud.commit(db)
    │           │      └ <sqlalchemy.orm.session.Session object at 0x0000014268F007D0>
    │           └ <function commit at 0x00000142690CEA20>
    └ <module 'app.crud.shared_crud' from 'C:\\Users\\tomas\\Documents\\Saityno Progr. Projektavimas\\StreamaBit\\app\\crud\\shared...

  File "C:\Users\tomas\Documents\Saityno Progr. Projektavimas\StreamaBit\app\crud\shared_crud.py", line 7, in commit
    return db.commit()
           │  └ <function Session.commit at 0x0000014268CB99E0>
           └ <sqlalchemy.orm.session.Session object at 0x0000014268F007D0>

  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\session.py", line 2028, in commit
    trans.commit(_to_root=True)
    │     └ <function SessionTransaction.commit at 0x0000014268CB8AE0>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x000001426A454DC0>
  File "<string>", line 2, in commit
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                │  │      │      └ {'_to_root': True}
                │  │      └ ()
                │  └ <sqlalchemy.orm.session.SessionTransaction object at 0x000001426A454DC0>
                └ <function SessionTransaction.commit at 0x0000014268CB8900>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\session.py", line 1313, in commit
    self._prepare_impl()
    │    └ <function SessionTransaction._prepare_impl at 0x0000014268CB87C0>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x000001426A454DC0>
  File "<string>", line 2, in _prepare_impl
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                │  │      │      └ {}
                │  │      └ ()
                │  └ <sqlalchemy.orm.session.SessionTransaction object at 0x000001426A454DC0>
                └ <function SessionTransaction._prepare_impl at 0x0000014268CB8720>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\session.py", line 1288, in _prepare_impl
    self.session.flush()
    │    │       └ <function Session.flush at 0x0000014268CC4900>
    │    └ <sqlalchemy.orm.session.Session object at 0x0000014268F007D0>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x000001426A454DC0>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\session.py", line 4352, in flush
    self._flush(objects)
    │    │      └ None
    │    └ <function Session._flush at 0x0000014268CC4AE0>
    └ <sqlalchemy.orm.session.Session object at 0x0000014268F007D0>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\session.py", line 4487, in _flush
    with util.safe_reraise():
         │    └ <class 'sqlalchemy.util.langhelpers.safe_reraise'>
         └ <module 'sqlalchemy.util' from 'C:\\Users\\tomas\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\site-packages\\sqlalchemy...
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
          │         │              └ <traceback object at 0x000001426A60F400>
          │         └ <method 'with_traceback' of 'BaseException' objects>
          └ IntegrityError('(psycopg2.errors.NotNullViolation) null value in column "fk_user_id" of relation "user_session" violates not-...
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\session.py", line 4448, in _flush
    flush_context.execute()
    │             └ <function UOWTransaction.execute at 0x0000014268CA93A0>
    └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x000001426A5AF6D0>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
    │   │       └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x000001426A5AF6D0>
    │   └ <function SaveUpdateAll.execute at 0x0000014268CA9EE0>
    └ SaveUpdateAll(Mapper[UserSession(user_session)])
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    │    │         │               └ <function save_obj at 0x0000014268C55A80>
    │    │         └ <module 'sqlalchemy.orm.persistence' from 'C:\\Users\\tomas\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\site-packages\...
    │    └ <module 'sqlalchemy.util.preloaded' from 'C:\\Users\\tomas\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\site-packages\\...
    └ <module 'sqlalchemy.util' from 'C:\\Users\\tomas\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\site-packages\\sqlalchemy...
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\persistence.py", line 85, in save_obj
    _emit_update_statements(
    └ <function _emit_update_statements at 0x0000014268CA00E0>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\persistence.py", line 912, in _emit_update_statements
    c = connection.execute(
        │          └ <function Connection.execute at 0x0000014268928360>
        └ <sqlalchemy.engine.base.Connection object at 0x000001426A59F010>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\engine\base.py", line 1418, in execute
    return meth(
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.dml.Update object at 0x000001426A60E850>>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\sql\elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x0000014268928680>
           └ <sqlalchemy.engine.base.Connection object at 0x000001426A59F010>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\engine\base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x0000014268928860>
          └ <sqlalchemy.engine.base.Connection object at 0x000001426A59F010>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\engine\base.py", line 1846, in _execute_context
    return self._exec_single_context(
           │    └ <function Connection._exec_single_context at 0x0000014268928900>
           └ <sqlalchemy.engine.base.Connection object at 0x000001426A59F010>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\engine\base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x0000014268928B80>
    └ <sqlalchemy.engine.base.Connection object at 0x000001426A59F010>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\engine\base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
          │                    │              │                 └ NotNullViolation('null value in column "fk_user_id" of relation "user_session" violates not-null constraint\nDETAIL:  Failing...
          │                    │              └ (<class 'psycopg2.errors.NotNullViolation'>, NotNullViolation('null value in column "fk_user_id" of relation "user_session" v...
          │                    └ <method 'with_traceback' of 'BaseException' objects>
          └ IntegrityError('(psycopg2.errors.NotNullViolation) null value in column "fk_user_id" of relation "user_session" violates not-...
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x00000142689EC360>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x0000014268DB4510>
    └ <sqlalchemy.engine.base.Connection object at 0x000001426A59F010>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\engine\default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'fk_user_id': None, 'user_session_session_id': 15}
    │      │       └ 'UPDATE user_session SET fk_user_id=%(fk_user_id)s WHERE user_session.session_id = %(user_session_session_id)s'
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x000001426A5CFBC0; closed: -1>

sqlalchemy.exc.IntegrityError: (psycopg2.errors.NotNullViolation) null value in column "fk_user_id" of relation "user_session" violates not-null constraint
DETAIL:  Failing row contains (15, 2024-11-06 13:16:04.68704+02, 127.0.0.1, null).

[SQL: UPDATE user_session SET fk_user_id=%(fk_user_id)s WHERE user_session.session_id = %(user_session_session_id)s]
[parameters: {'fk_user_id': None, 'user_session_session_id': 15}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2024-11-07 00:25:01.702 | INFO     | app.services.user_service:remove_user:121 - 
REMOVING USER ACCOUNT
2024-11-07 00:25:01.703 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:29 - Validating input
2024-11-07 00:25:01.704 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:60 - Input passed validation
2024-11-07 00:25:01.704 | INFO     | app.validators.user_validator:validate_username:17 - Validating username format
2024-11-07 00:25:01.705 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:29 - Validating input
2024-11-07 00:25:01.705 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:60 - Input passed validation
2024-11-07 00:25:01.705 | INFO     | app.validators.shared_validator:letters_numbers_only:17 - Validating input
2024-11-07 00:25:01.705 | INFO     | app.validators.shared_validator:letters_numbers_only:23 - Input passed validation
2024-11-07 00:25:01.706 | INFO     | app.validators.user_validator:validate_username:31 - Username validation passed
2024-11-07 00:25:01.706 | INFO     | app.validators.user_validator:validate_email:39 - Validating email format
2024-11-07 00:25:01.706 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:29 - Validating input
2024-11-07 00:25:01.706 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:60 - Input passed validation
2024-11-07 00:25:01.707 | INFO     | app.validators.user_validator:validate_email:54 - Email validation passed
2024-11-07 00:25:01.707 | INFO     | app.validators.user_validator:validate_password:62 - Validating password format
2024-11-07 00:25:01.707 | INFO     | app.validators.user_validator:validate_password:89 - Password validation passed
2024-11-07 00:25:01.707 | INFO     | app.crud.user_crud:get_authenticated_user:52 - Searching for user by specified username, email and password_hash
2024-11-07 00:25:01.729 | INFO     | app.crud.user_crud:get_authenticated_user:56 - User found
2024-11-07 00:25:01.752 | ERROR    | app.services.user_service:remove_user:143 - 
USER ACCOUNT HAS NOT BEEN REMOVED, EXCEPTION OCCURED: (psycopg2.errors.NotNullViolation) null value in column "fk_user_id" of relation "user_session" violates not-null constraint
DETAIL:  Failing row contains (15, 2024-11-06 13:16:04.68704+02, 127.0.0.1, null).

[SQL: UPDATE user_session SET fk_user_id=%(fk_user_id)s WHERE user_session.session_id = %(user_session_session_id)s]
[parameters: {'fk_user_id': None, 'user_session_session_id': 15}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):

  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x000001BE7FACC360>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x000001BE7FE94850>
    └ <sqlalchemy.engine.base.Connection object at 0x000001BE011E1A50>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\engine\default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'fk_user_id': None, 'user_session_session_id': 15}
    │      │       └ 'UPDATE user_session SET fk_user_id=%(fk_user_id)s WHERE user_session.session_id = %(user_session_session_id)s'
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x000001BE016BBAE0; closed: -1>

psycopg2.errors.NotNullViolation: null value in column "fk_user_id" of relation "user_session" violates not-null constraint
DETAIL:  Failing row contains (15, 2024-11-06 13:16:04.68704+02, 127.0.0.1, null).



The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\threading.py", line 1002, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x000001BE7BCF4860>
    └ <WorkerThread(AnyIO worker thread, started 16448)>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\threading.py", line 1045, in _bootstrap_inner
    self.run()
    │    └ <function WorkerThread.run at 0x000001BE0127C400>
    └ <WorkerThread(AnyIO worker thread, started 16448)>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\anyio\_backends\_asyncio.py", line 914, in run
    result = context.run(func, *args)
             │       │   │      └ ()
             │       │   └ functools.partial(<function delete_user at 0x000001BE011D2660>, db=<sqlalchemy.orm.session.Session object at 0x000001BE0120B8...
             │       └ <method 'run' of '_contextvars.Context' objects>
             └ <_contextvars.Context object at 0x000001BE012277C0>

  File "C:\Users\tomas\Documents\Saityno Progr. Projektavimas\StreamaBit\app\main.py", line 61, in delete_user
    return user_services.remove_user(db=db, username=username, data=data)
           │             │              │            │              └ UserDelete(email='firstUser55@gmail.com', password='Password1234$')
           │             │              │            └ 'First55Select'
           │             │              └ <sqlalchemy.orm.session.Session object at 0x000001BE0120B890>
           │             └ <function remove_user at 0x000001BE001CEC00>
           └ <module 'app.services.user_service' from 'C:\\Users\\tomas\\Documents\\Saityno Progr. Projektavimas\\StreamaBit\\app\\service...

> File "C:\Users\tomas\Documents\Saityno Progr. Projektavimas\StreamaBit\app\services\user_service.py", line 138, in remove_user
    shared_crud.flush(db)
    │           │     └ <sqlalchemy.orm.session.Session object at 0x000001BE0120B890>
    │           └ <function flush at 0x000001BE001CE980>
    └ <module 'app.crud.shared_crud' from 'C:\\Users\\tomas\\Documents\\Saityno Progr. Projektavimas\\StreamaBit\\app\\crud\\shared...

  File "C:\Users\tomas\Documents\Saityno Progr. Projektavimas\StreamaBit\app\crud\shared_crud.py", line 4, in flush
    return db.flush()
           │  └ <function Session.flush at 0x000001BE7FDA4900>
           └ <sqlalchemy.orm.session.Session object at 0x000001BE0120B890>

  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\session.py", line 4352, in flush
    self._flush(objects)
    │    │      └ None
    │    └ <function Session._flush at 0x000001BE7FDA4AE0>
    └ <sqlalchemy.orm.session.Session object at 0x000001BE0120B890>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\session.py", line 4487, in _flush
    with util.safe_reraise():
         │    └ <class 'sqlalchemy.util.langhelpers.safe_reraise'>
         └ <module 'sqlalchemy.util' from 'C:\\Users\\tomas\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\site-packages\\sqlalchemy...
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
          │         │              └ <traceback object at 0x000001BE016FEF80>
          │         └ <method 'with_traceback' of 'BaseException' objects>
          └ IntegrityError('(psycopg2.errors.NotNullViolation) null value in column "fk_user_id" of relation "user_session" violates not-...
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\session.py", line 4448, in _flush
    flush_context.execute()
    │             └ <function UOWTransaction.execute at 0x000001BE7FD893A0>
    └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x000001BE01214510>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
    │   │       └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x000001BE01214510>
    │   └ <function SaveUpdateAll.execute at 0x000001BE7FD89EE0>
    └ SaveUpdateAll(Mapper[UserSession(user_session)])
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    │    │         │               └ <function save_obj at 0x000001BE7FD35A80>
    │    │         └ <module 'sqlalchemy.orm.persistence' from 'C:\\Users\\tomas\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\site-packages\...
    │    └ <module 'sqlalchemy.util.preloaded' from 'C:\\Users\\tomas\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\site-packages\\...
    └ <module 'sqlalchemy.util' from 'C:\\Users\\tomas\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\site-packages\\sqlalchemy...
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\persistence.py", line 85, in save_obj
    _emit_update_statements(
    └ <function _emit_update_statements at 0x000001BE7FD800E0>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\persistence.py", line 912, in _emit_update_statements
    c = connection.execute(
        │          └ <function Connection.execute at 0x000001BE7FA08360>
        └ <sqlalchemy.engine.base.Connection object at 0x000001BE011E1A50>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\engine\base.py", line 1418, in execute
    return meth(
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.dml.Update object at 0x000001BE016FE3D0>>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\sql\elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x000001BE7FA08680>
           └ <sqlalchemy.engine.base.Connection object at 0x000001BE011E1A50>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\engine\base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x000001BE7FA08860>
          └ <sqlalchemy.engine.base.Connection object at 0x000001BE011E1A50>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\engine\base.py", line 1846, in _execute_context
    return self._exec_single_context(
           │    └ <function Connection._exec_single_context at 0x000001BE7FA08900>
           └ <sqlalchemy.engine.base.Connection object at 0x000001BE011E1A50>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\engine\base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x000001BE7FA08B80>
    └ <sqlalchemy.engine.base.Connection object at 0x000001BE011E1A50>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\engine\base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
          │                    │              │                 └ NotNullViolation('null value in column "fk_user_id" of relation "user_session" violates not-null constraint\nDETAIL:  Failing...
          │                    │              └ (<class 'psycopg2.errors.NotNullViolation'>, NotNullViolation('null value in column "fk_user_id" of relation "user_session" v...
          │                    └ <method 'with_traceback' of 'BaseException' objects>
          └ IntegrityError('(psycopg2.errors.NotNullViolation) null value in column "fk_user_id" of relation "user_session" violates not-...
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x000001BE7FACC360>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x000001BE7FE94850>
    └ <sqlalchemy.engine.base.Connection object at 0x000001BE011E1A50>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\engine\default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'fk_user_id': None, 'user_session_session_id': 15}
    │      │       └ 'UPDATE user_session SET fk_user_id=%(fk_user_id)s WHERE user_session.session_id = %(user_session_session_id)s'
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x000001BE016BBAE0; closed: -1>

sqlalchemy.exc.IntegrityError: (psycopg2.errors.NotNullViolation) null value in column "fk_user_id" of relation "user_session" violates not-null constraint
DETAIL:  Failing row contains (15, 2024-11-06 13:16:04.68704+02, 127.0.0.1, null).

[SQL: UPDATE user_session SET fk_user_id=%(fk_user_id)s WHERE user_session.session_id = %(user_session_session_id)s]
[parameters: {'fk_user_id': None, 'user_session_session_id': 15}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2024-11-07 00:26:49.128 | INFO     | app.services.user_service:remove_user:121 - 
REMOVING USER ACCOUNT
2024-11-07 00:26:49.129 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:29 - Validating input
2024-11-07 00:26:49.130 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:60 - Input passed validation
2024-11-07 00:26:49.131 | INFO     | app.validators.user_validator:validate_username:17 - Validating username format
2024-11-07 00:26:49.131 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:29 - Validating input
2024-11-07 00:26:49.132 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:60 - Input passed validation
2024-11-07 00:26:49.132 | INFO     | app.validators.shared_validator:letters_numbers_only:17 - Validating input
2024-11-07 00:26:49.132 | INFO     | app.validators.shared_validator:letters_numbers_only:23 - Input passed validation
2024-11-07 00:26:49.132 | INFO     | app.validators.user_validator:validate_username:31 - Username validation passed
2024-11-07 00:26:49.132 | INFO     | app.validators.user_validator:validate_email:39 - Validating email format
2024-11-07 00:26:49.132 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:29 - Validating input
2024-11-07 00:26:49.133 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:60 - Input passed validation
2024-11-07 00:26:49.133 | INFO     | app.validators.user_validator:validate_email:54 - Email validation passed
2024-11-07 00:26:49.133 | INFO     | app.validators.user_validator:validate_password:62 - Validating password format
2024-11-07 00:26:49.133 | INFO     | app.validators.user_validator:validate_password:89 - Password validation passed
2024-11-07 00:26:49.134 | INFO     | app.crud.user_crud:get_authenticated_user:52 - Searching for user by specified username, email and password_hash
2024-11-07 00:26:49.156 | INFO     | app.crud.user_crud:get_authenticated_user:56 - User found
2024-11-07 00:26:49.179 | ERROR    | app.crud.user_crud:delete:147 - Exception with user_id=80: 500: An unexpected error occurred
Traceback (most recent call last):

  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x0000017C80AEC360>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x0000017C80EB47D0>
    └ <sqlalchemy.engine.base.Connection object at 0x0000017C8268ED50>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\engine\default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'fk_user_id': None, 'user_session_session_id': 15}
    │      │       └ 'UPDATE user_session SET fk_user_id=%(fk_user_id)s WHERE user_session.session_id = %(user_session_session_id)s'
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x0000017C826BFBC0; closed: -1>

psycopg2.errors.NotNullViolation: null value in column "fk_user_id" of relation "user_session" violates not-null constraint
DETAIL:  Failing row contains (15, 2024-11-06 13:16:04.68704+02, 127.0.0.1, null).



The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "C:\Users\tomas\Documents\Saityno Progr. Projektavimas\StreamaBit\app\crud\user_crud.py", line 137, in delete
    db.commit()
    │  └ <function Session.commit at 0x0000017C80DB99E0>
    └ <sqlalchemy.orm.session.Session object at 0x0000017C82223350>

  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\session.py", line 2028, in commit
    trans.commit(_to_root=True)
    │     └ <function SessionTransaction.commit at 0x0000017C80DB8AE0>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x0000017C82640FF0>
  File "<string>", line 2, in commit
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                │  │      │      └ {'_to_root': True}
                │  │      └ ()
                │  └ <sqlalchemy.orm.session.SessionTransaction object at 0x0000017C82640FF0>
                └ <function SessionTransaction.commit at 0x0000017C80DB8900>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\session.py", line 1313, in commit
    self._prepare_impl()
    │    └ <function SessionTransaction._prepare_impl at 0x0000017C80DB87C0>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x0000017C82640FF0>
  File "<string>", line 2, in _prepare_impl
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                │  │      │      └ {}
                │  │      └ ()
                │  └ <sqlalchemy.orm.session.SessionTransaction object at 0x0000017C82640FF0>
                └ <function SessionTransaction._prepare_impl at 0x0000017C80DB8720>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\session.py", line 1288, in _prepare_impl
    self.session.flush()
    │    │       └ <function Session.flush at 0x0000017C80DC4900>
    │    └ <sqlalchemy.orm.session.Session object at 0x0000017C82223350>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x0000017C82640FF0>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\session.py", line 4352, in flush
    self._flush(objects)
    │    │      └ None
    │    └ <function Session._flush at 0x0000017C80DC4AE0>
    └ <sqlalchemy.orm.session.Session object at 0x0000017C82223350>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\session.py", line 4487, in _flush
    with util.safe_reraise():
         │    └ <class 'sqlalchemy.util.langhelpers.safe_reraise'>
         └ <module 'sqlalchemy.util' from 'C:\\Users\\tomas\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\site-packages\\sqlalchemy...
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
          │         │              └ <traceback object at 0x0000017C82703200>
          │         └ <method 'with_traceback' of 'BaseException' objects>
          └ IntegrityError('(psycopg2.errors.NotNullViolation) null value in column "fk_user_id" of relation "user_session" violates not-...
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\session.py", line 4448, in _flush
    flush_context.execute()
    │             └ <function UOWTransaction.execute at 0x0000017C80DA93A0>
    └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x0000017C82215650>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
    │   │       └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x0000017C82215650>
    │   └ <function SaveUpdateAll.execute at 0x0000017C80DA9EE0>
    └ SaveUpdateAll(Mapper[UserSession(user_session)])
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    │    │         │               └ <function save_obj at 0x0000017C80D55A80>
    │    │         └ <module 'sqlalchemy.orm.persistence' from 'C:\\Users\\tomas\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\site-packages\...
    │    └ <module 'sqlalchemy.util.preloaded' from 'C:\\Users\\tomas\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\site-packages\\...
    └ <module 'sqlalchemy.util' from 'C:\\Users\\tomas\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\site-packages\\sqlalchemy...
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\persistence.py", line 85, in save_obj
    _emit_update_statements(
    └ <function _emit_update_statements at 0x0000017C80DA00E0>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\persistence.py", line 912, in _emit_update_statements
    c = connection.execute(
        │          └ <function Connection.execute at 0x0000017C80A28360>
        └ <sqlalchemy.engine.base.Connection object at 0x0000017C8268ED50>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\engine\base.py", line 1418, in execute
    return meth(
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.dml.Update object at 0x0000017C82702510>>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\sql\elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x0000017C80A28680>
           └ <sqlalchemy.engine.base.Connection object at 0x0000017C8268ED50>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\engine\base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x0000017C80A28860>
          └ <sqlalchemy.engine.base.Connection object at 0x0000017C8268ED50>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\engine\base.py", line 1846, in _execute_context
    return self._exec_single_context(
           │    └ <function Connection._exec_single_context at 0x0000017C80A28900>
           └ <sqlalchemy.engine.base.Connection object at 0x0000017C8268ED50>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\engine\base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x0000017C80A28B80>
    └ <sqlalchemy.engine.base.Connection object at 0x0000017C8268ED50>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\engine\base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
          │                    │              │                 └ NotNullViolation('null value in column "fk_user_id" of relation "user_session" violates not-null constraint\nDETAIL:  Failing...
          │                    │              └ (<class 'psycopg2.errors.NotNullViolation'>, NotNullViolation('null value in column "fk_user_id" of relation "user_session" v...
          │                    └ <method 'with_traceback' of 'BaseException' objects>
          └ IntegrityError('(psycopg2.errors.NotNullViolation) null value in column "fk_user_id" of relation "user_session" violates not-...
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x0000017C80AEC360>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x0000017C80EB47D0>
    └ <sqlalchemy.engine.base.Connection object at 0x0000017C8268ED50>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\engine\default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'fk_user_id': None, 'user_session_session_id': 15}
    │      │       └ 'UPDATE user_session SET fk_user_id=%(fk_user_id)s WHERE user_session.session_id = %(user_session_session_id)s'
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x0000017C826BFBC0; closed: -1>

sqlalchemy.exc.IntegrityError: (psycopg2.errors.NotNullViolation) null value in column "fk_user_id" of relation "user_session" violates not-null constraint
DETAIL:  Failing row contains (15, 2024-11-06 13:16:04.68704+02, 127.0.0.1, null).

[SQL: UPDATE user_session SET fk_user_id=%(fk_user_id)s WHERE user_session.session_id = %(user_session_session_id)s]
[parameters: {'fk_user_id': None, 'user_session_session_id': 15}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\threading.py", line 1002, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x0000017CFCD44860>
    └ <WorkerThread(AnyIO worker thread, started 30248)>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\threading.py", line 1045, in _bootstrap_inner
    self.run()
    │    └ <function WorkerThread.run at 0x0000017C82278400>
    └ <WorkerThread(AnyIO worker thread, started 30248)>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\anyio\_backends\_asyncio.py", line 914, in run
    result = context.run(func, *args)
             │       │   │      └ ()
             │       │   └ functools.partial(<function delete_user at 0x0000017C811FA700>, db=<sqlalchemy.orm.session.Session object at 0x0000017C822233...
             │       └ <method 'run' of '_contextvars.Context' objects>
             └ <_contextvars.Context object at 0x0000017C82221AC0>

  File "C:\Users\tomas\Documents\Saityno Progr. Projektavimas\StreamaBit\app\main.py", line 61, in delete_user
    return user_services.remove_user(db=db, username=username, data=data)
           │             │              │            │              └ UserDelete(email='firstUser55@gmail.com', password='Password1234$')
           │             │              │            └ 'First55Select'
           │             │              └ <sqlalchemy.orm.session.Session object at 0x0000017C82223350>
           │             └ <function remove_user at 0x0000017C811CEE80>
           └ <module 'app.services.user_service' from 'C:\\Users\\tomas\\Documents\\Saityno Progr. Projektavimas\\StreamaBit\\app\\service...

  File "C:\Users\tomas\Documents\Saityno Progr. Projektavimas\StreamaBit\app\services\user_service.py", line 137, in remove_user
    user_crud.delete(db=db, user_id=db_user.user_id)
    │         │         │           │       └ <sqlalchemy.orm.attributes.InstrumentedAttribute object at 0x0000017C81087600>
    │         │         │           └ <app.models.database.User object at 0x0000017C8269F950>
    │         │         └ <sqlalchemy.orm.session.Session object at 0x0000017C82223350>
    │         └ <function delete at 0x0000017C811CEAC0>
    └ <module 'app.crud.user_crud' from 'C:\\Users\\tomas\\Documents\\Saityno Progr. Projektavimas\\StreamaBit\\app\\crud\\user_cru...

> File "C:\Users\tomas\Documents\Saityno Progr. Projektavimas\StreamaBit\app\crud\user_crud.py", line 141, in delete
    raise HTTPException(status_code=500, detail="An unexpected error occurred")
          └ <class 'fastapi.exceptions.HTTPException'>

fastapi.exceptions.HTTPException: 500: An unexpected error occurred
2024-11-07 00:26:49.202 | ERROR    | app.services.user_service:remove_user:143 - 
USER ACCOUNT HAS NOT BEEN REMOVED, EXCEPTION OCCURED: 500: An unexpected error occurred
Traceback (most recent call last):

  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x0000017C80AEC360>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x0000017C80EB47D0>
    └ <sqlalchemy.engine.base.Connection object at 0x0000017C8268ED50>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\engine\default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'fk_user_id': None, 'user_session_session_id': 15}
    │      │       └ 'UPDATE user_session SET fk_user_id=%(fk_user_id)s WHERE user_session.session_id = %(user_session_session_id)s'
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x0000017C826BFBC0; closed: -1>

psycopg2.errors.NotNullViolation: null value in column "fk_user_id" of relation "user_session" violates not-null constraint
DETAIL:  Failing row contains (15, 2024-11-06 13:16:04.68704+02, 127.0.0.1, null).



The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "C:\Users\tomas\Documents\Saityno Progr. Projektavimas\StreamaBit\app\crud\user_crud.py", line 137, in delete
    db.commit()
    │  └ <function Session.commit at 0x0000017C80DB99E0>
    └ <sqlalchemy.orm.session.Session object at 0x0000017C82223350>

  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\session.py", line 2028, in commit
    trans.commit(_to_root=True)
    │     └ <function SessionTransaction.commit at 0x0000017C80DB8AE0>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x0000017C82640FF0>
  File "<string>", line 2, in commit
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                │  │      │      └ {'_to_root': True}
                │  │      └ ()
                │  └ <sqlalchemy.orm.session.SessionTransaction object at 0x0000017C82640FF0>
                └ <function SessionTransaction.commit at 0x0000017C80DB8900>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\session.py", line 1313, in commit
    self._prepare_impl()
    │    └ <function SessionTransaction._prepare_impl at 0x0000017C80DB87C0>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x0000017C82640FF0>
  File "<string>", line 2, in _prepare_impl
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                │  │      │      └ {}
                │  │      └ ()
                │  └ <sqlalchemy.orm.session.SessionTransaction object at 0x0000017C82640FF0>
                └ <function SessionTransaction._prepare_impl at 0x0000017C80DB8720>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\session.py", line 1288, in _prepare_impl
    self.session.flush()
    │    │       └ <function Session.flush at 0x0000017C80DC4900>
    │    └ <sqlalchemy.orm.session.Session object at 0x0000017C82223350>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x0000017C82640FF0>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\session.py", line 4352, in flush
    self._flush(objects)
    │    │      └ None
    │    └ <function Session._flush at 0x0000017C80DC4AE0>
    └ <sqlalchemy.orm.session.Session object at 0x0000017C82223350>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\session.py", line 4487, in _flush
    with util.safe_reraise():
         │    └ <class 'sqlalchemy.util.langhelpers.safe_reraise'>
         └ <module 'sqlalchemy.util' from 'C:\\Users\\tomas\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\site-packages\\sqlalchemy...
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
          │         │              └ <traceback object at 0x0000017C82703200>
          │         └ <method 'with_traceback' of 'BaseException' objects>
          └ IntegrityError('(psycopg2.errors.NotNullViolation) null value in column "fk_user_id" of relation "user_session" violates not-...
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\session.py", line 4448, in _flush
    flush_context.execute()
    │             └ <function UOWTransaction.execute at 0x0000017C80DA93A0>
    └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x0000017C82215650>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
    │   │       └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x0000017C82215650>
    │   └ <function SaveUpdateAll.execute at 0x0000017C80DA9EE0>
    └ SaveUpdateAll(Mapper[UserSession(user_session)])
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    │    │         │               └ <function save_obj at 0x0000017C80D55A80>
    │    │         └ <module 'sqlalchemy.orm.persistence' from 'C:\\Users\\tomas\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\site-packages\...
    │    └ <module 'sqlalchemy.util.preloaded' from 'C:\\Users\\tomas\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\site-packages\\...
    └ <module 'sqlalchemy.util' from 'C:\\Users\\tomas\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\site-packages\\sqlalchemy...
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\persistence.py", line 85, in save_obj
    _emit_update_statements(
    └ <function _emit_update_statements at 0x0000017C80DA00E0>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\persistence.py", line 912, in _emit_update_statements
    c = connection.execute(
        │          └ <function Connection.execute at 0x0000017C80A28360>
        └ <sqlalchemy.engine.base.Connection object at 0x0000017C8268ED50>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\engine\base.py", line 1418, in execute
    return meth(
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.dml.Update object at 0x0000017C82702510>>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\sql\elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x0000017C80A28680>
           └ <sqlalchemy.engine.base.Connection object at 0x0000017C8268ED50>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\engine\base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x0000017C80A28860>
          └ <sqlalchemy.engine.base.Connection object at 0x0000017C8268ED50>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\engine\base.py", line 1846, in _execute_context
    return self._exec_single_context(
           │    └ <function Connection._exec_single_context at 0x0000017C80A28900>
           └ <sqlalchemy.engine.base.Connection object at 0x0000017C8268ED50>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\engine\base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x0000017C80A28B80>
    └ <sqlalchemy.engine.base.Connection object at 0x0000017C8268ED50>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\engine\base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
          │                    │              │                 └ NotNullViolation('null value in column "fk_user_id" of relation "user_session" violates not-null constraint\nDETAIL:  Failing...
          │                    │              └ (<class 'psycopg2.errors.NotNullViolation'>, NotNullViolation('null value in column "fk_user_id" of relation "user_session" v...
          │                    └ <method 'with_traceback' of 'BaseException' objects>
          └ IntegrityError('(psycopg2.errors.NotNullViolation) null value in column "fk_user_id" of relation "user_session" violates not-...
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x0000017C80AEC360>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x0000017C80EB47D0>
    └ <sqlalchemy.engine.base.Connection object at 0x0000017C8268ED50>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\engine\default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'fk_user_id': None, 'user_session_session_id': 15}
    │      │       └ 'UPDATE user_session SET fk_user_id=%(fk_user_id)s WHERE user_session.session_id = %(user_session_session_id)s'
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x0000017C826BFBC0; closed: -1>

sqlalchemy.exc.IntegrityError: (psycopg2.errors.NotNullViolation) null value in column "fk_user_id" of relation "user_session" violates not-null constraint
DETAIL:  Failing row contains (15, 2024-11-06 13:16:04.68704+02, 127.0.0.1, null).

[SQL: UPDATE user_session SET fk_user_id=%(fk_user_id)s WHERE user_session.session_id = %(user_session_session_id)s]
[parameters: {'fk_user_id': None, 'user_session_session_id': 15}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\tomas\Documents\Saityno Progr. Projektavimas\StreamaBit\app\crud\user_crud.py", line 141, in delete
    raise HTTPException(status_code=500, detail="An unexpected error occurred")
          └ <class 'fastapi.exceptions.HTTPException'>

fastapi.exceptions.HTTPException: 500: An unexpected error occurred


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\threading.py", line 1002, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x0000017CFCD44860>
    └ <WorkerThread(AnyIO worker thread, started 30248)>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\threading.py", line 1045, in _bootstrap_inner
    self.run()
    │    └ <function WorkerThread.run at 0x0000017C82278400>
    └ <WorkerThread(AnyIO worker thread, started 30248)>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\anyio\_backends\_asyncio.py", line 914, in run
    result = context.run(func, *args)
             │       │   │      └ ()
             │       │   └ functools.partial(<function delete_user at 0x0000017C811FA700>, db=<sqlalchemy.orm.session.Session object at 0x0000017C822233...
             │       └ <method 'run' of '_contextvars.Context' objects>
             └ <_contextvars.Context object at 0x0000017C82221AC0>

  File "C:\Users\tomas\Documents\Saityno Progr. Projektavimas\StreamaBit\app\main.py", line 61, in delete_user
    return user_services.remove_user(db=db, username=username, data=data)
           │             │              │            │              └ UserDelete(email='firstUser55@gmail.com', password='Password1234$')
           │             │              │            └ 'First55Select'
           │             │              └ <sqlalchemy.orm.session.Session object at 0x0000017C82223350>
           │             └ <function remove_user at 0x0000017C811CEE80>
           └ <module 'app.services.user_service' from 'C:\\Users\\tomas\\Documents\\Saityno Progr. Projektavimas\\StreamaBit\\app\\service...

> File "C:\Users\tomas\Documents\Saityno Progr. Projektavimas\StreamaBit\app\services\user_service.py", line 137, in remove_user
    user_crud.delete(db=db, user_id=db_user.user_id)
    │         │         │           │       └ <sqlalchemy.orm.attributes.InstrumentedAttribute object at 0x0000017C81087600>
    │         │         │           └ <app.models.database.User object at 0x0000017C8269F950>
    │         │         └ <sqlalchemy.orm.session.Session object at 0x0000017C82223350>
    │         └ <function delete at 0x0000017C811CEAC0>
    └ <module 'app.crud.user_crud' from 'C:\\Users\\tomas\\Documents\\Saityno Progr. Projektavimas\\StreamaBit\\app\\crud\\user_cru...

  File "C:\Users\tomas\Documents\Saityno Progr. Projektavimas\StreamaBit\app\crud\user_crud.py", line 148, in delete
    raise HTTPException(status_code=500, detail="An unexpected error occurred")
          └ <class 'fastapi.exceptions.HTTPException'>

fastapi.exceptions.HTTPException: 500: An unexpected error occurred
2024-11-07 00:30:18.734 | INFO     | app.services.user_service:remove_user:121 - 
REMOVING USER ACCOUNT
2024-11-07 00:30:18.735 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:29 - Validating input
2024-11-07 00:30:18.736 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:60 - Input passed validation
2024-11-07 00:30:18.736 | INFO     | app.validators.user_validator:validate_username:17 - Validating username format
2024-11-07 00:30:18.736 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:29 - Validating input
2024-11-07 00:30:18.737 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:60 - Input passed validation
2024-11-07 00:30:18.737 | INFO     | app.validators.shared_validator:letters_numbers_only:17 - Validating input
2024-11-07 00:30:18.737 | INFO     | app.validators.shared_validator:letters_numbers_only:23 - Input passed validation
2024-11-07 00:30:18.737 | INFO     | app.validators.user_validator:validate_username:31 - Username validation passed
2024-11-07 00:30:18.738 | INFO     | app.validators.user_validator:validate_email:39 - Validating email format
2024-11-07 00:30:18.738 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:29 - Validating input
2024-11-07 00:30:18.738 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:60 - Input passed validation
2024-11-07 00:30:18.739 | INFO     | app.validators.user_validator:validate_email:54 - Email validation passed
2024-11-07 00:30:18.739 | INFO     | app.validators.user_validator:validate_password:62 - Validating password format
2024-11-07 00:30:18.739 | INFO     | app.validators.user_validator:validate_password:89 - Password validation passed
2024-11-07 00:30:18.739 | INFO     | app.crud.user_crud:get_authenticated_user:52 - Searching for user by specified username, email and password_hash
2024-11-07 00:30:18.761 | INFO     | app.crud.user_crud:get_authenticated_user:56 - User found
2024-11-07 00:30:18.766 | INFO     | app.crud.user_crud:delete:130 - Attempting to remove user account
2024-11-07 00:30:18.768 | INFO     | app.crud.user_crud:delete:138 - User prepared for account removal, waiting for transaction commit
2024-11-07 00:30:18.783 | ERROR    | app.services.user_service:remove_user:142 - 
USER ACCOUNT HAS NOT BEEN REMOVED, EXCEPTION OCCURED: (psycopg2.errors.NotNullViolation) null value in column "fk_user_id" of relation "user_session" violates not-null constraint
DETAIL:  Failing row contains (15, 2024-11-06 13:16:04.68704+02, 127.0.0.1, null).

[SQL: UPDATE user_session SET fk_user_id=%(fk_user_id)s WHERE user_session.session_id = %(user_session_session_id)s]
[parameters: {'fk_user_id': None, 'user_session_session_id': 15}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):

  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x00000140F4C2C360>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x00000140F4FF47D0>
    └ <sqlalchemy.engine.base.Connection object at 0x00000140F67DF2D0>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\engine\default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'fk_user_id': None, 'user_session_session_id': 15}
    │      │       └ 'UPDATE user_session SET fk_user_id=%(fk_user_id)s WHERE user_session.session_id = %(user_session_session_id)s'
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x00000140F680BBC0; closed: -1>

psycopg2.errors.NotNullViolation: null value in column "fk_user_id" of relation "user_session" violates not-null constraint
DETAIL:  Failing row contains (15, 2024-11-06 13:16:04.68704+02, 127.0.0.1, null).



The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\threading.py", line 1002, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x00000140F0ED4860>
    └ <WorkerThread(AnyIO worker thread, started 27356)>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\threading.py", line 1045, in _bootstrap_inner
    self.run()
    │    └ <function WorkerThread.run at 0x00000140F66F84A0>
    └ <WorkerThread(AnyIO worker thread, started 27356)>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\anyio\_backends\_asyncio.py", line 914, in run
    result = context.run(func, *args)
             │       │   │      └ ()
             │       │   └ functools.partial(<function delete_user at 0x00000140F6652660>, db=<sqlalchemy.orm.session.Session object at 0x00000140F66744...
             │       └ <method 'run' of '_contextvars.Context' objects>
             └ <_contextvars.Context object at 0x00000140F6691880>

  File "C:\Users\tomas\Documents\Saityno Progr. Projektavimas\StreamaBit\app\main.py", line 61, in delete_user
    return user_services.remove_user(db=db, username=username, data=data)
           │             │              │            │              └ UserDelete(email='firstUser55@gmail.com', password='Password1234$')
           │             │              │            └ 'First55Select'
           │             │              └ <sqlalchemy.orm.session.Session object at 0x00000140F6674450>
           │             └ <function remove_user at 0x00000140F530EC00>
           └ <module 'app.services.user_service' from 'C:\\Users\\tomas\\Documents\\Saityno Progr. Projektavimas\\StreamaBit\\app\\service...

> File "C:\Users\tomas\Documents\Saityno Progr. Projektavimas\StreamaBit\app\services\user_service.py", line 138, in remove_user
    shared_crud.commit(db)
    │           │      └ <sqlalchemy.orm.session.Session object at 0x00000140F6674450>
    │           └ <function commit at 0x00000140F530EA20>
    └ <module 'app.crud.shared_crud' from 'C:\\Users\\tomas\\Documents\\Saityno Progr. Projektavimas\\StreamaBit\\app\\crud\\shared...

  File "C:\Users\tomas\Documents\Saityno Progr. Projektavimas\StreamaBit\app\crud\shared_crud.py", line 7, in commit
    return db.commit()
           │  └ <function Session.commit at 0x00000140F4EF99E0>
           └ <sqlalchemy.orm.session.Session object at 0x00000140F6674450>

  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\session.py", line 2028, in commit
    trans.commit(_to_root=True)
    │     └ <function SessionTransaction.commit at 0x00000140F4EF8AE0>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x00000140F66FF5C0>
  File "<string>", line 2, in commit
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                │  │      │      └ {'_to_root': True}
                │  │      └ ()
                │  └ <sqlalchemy.orm.session.SessionTransaction object at 0x00000140F66FF5C0>
                └ <function SessionTransaction.commit at 0x00000140F4EF8900>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\session.py", line 1313, in commit
    self._prepare_impl()
    │    └ <function SessionTransaction._prepare_impl at 0x00000140F4EF87C0>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x00000140F66FF5C0>
  File "<string>", line 2, in _prepare_impl
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                │  │      │      └ {}
                │  │      └ ()
                │  └ <sqlalchemy.orm.session.SessionTransaction object at 0x00000140F66FF5C0>
                └ <function SessionTransaction._prepare_impl at 0x00000140F4EF8720>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\session.py", line 1288, in _prepare_impl
    self.session.flush()
    │    │       └ <function Session.flush at 0x00000140F4F04900>
    │    └ <sqlalchemy.orm.session.Session object at 0x00000140F6674450>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x00000140F66FF5C0>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\session.py", line 4352, in flush
    self._flush(objects)
    │    │      └ None
    │    └ <function Session._flush at 0x00000140F4F04AE0>
    └ <sqlalchemy.orm.session.Session object at 0x00000140F6674450>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\session.py", line 4487, in _flush
    with util.safe_reraise():
         │    └ <class 'sqlalchemy.util.langhelpers.safe_reraise'>
         └ <module 'sqlalchemy.util' from 'C:\\Users\\tomas\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\site-packages\\sqlalchemy...
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
          │         │              └ <traceback object at 0x00000140F684F500>
          │         └ <method 'with_traceback' of 'BaseException' objects>
          └ IntegrityError('(psycopg2.errors.NotNullViolation) null value in column "fk_user_id" of relation "user_session" violates not-...
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\session.py", line 4448, in _flush
    flush_context.execute()
    │             └ <function UOWTransaction.execute at 0x00000140F4EE93A0>
    └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x00000140F6657B10>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
    │   │       └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x00000140F6657B10>
    │   └ <function SaveUpdateAll.execute at 0x00000140F4EE9EE0>
    └ SaveUpdateAll(Mapper[UserSession(user_session)])
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    │    │         │               └ <function save_obj at 0x00000140F4E95A80>
    │    │         └ <module 'sqlalchemy.orm.persistence' from 'C:\\Users\\tomas\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\site-packages\...
    │    └ <module 'sqlalchemy.util.preloaded' from 'C:\\Users\\tomas\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\site-packages\\...
    └ <module 'sqlalchemy.util' from 'C:\\Users\\tomas\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\site-packages\\sqlalchemy...
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\persistence.py", line 85, in save_obj
    _emit_update_statements(
    └ <function _emit_update_statements at 0x00000140F4EE00E0>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\persistence.py", line 912, in _emit_update_statements
    c = connection.execute(
        │          └ <function Connection.execute at 0x00000140F4B68360>
        └ <sqlalchemy.engine.base.Connection object at 0x00000140F67DF2D0>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\engine\base.py", line 1418, in execute
    return meth(
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.dml.Update object at 0x00000140F684E950>>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\sql\elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x00000140F4B68680>
           └ <sqlalchemy.engine.base.Connection object at 0x00000140F67DF2D0>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\engine\base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x00000140F4B68860>
          └ <sqlalchemy.engine.base.Connection object at 0x00000140F67DF2D0>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\engine\base.py", line 1846, in _execute_context
    return self._exec_single_context(
           │    └ <function Connection._exec_single_context at 0x00000140F4B68900>
           └ <sqlalchemy.engine.base.Connection object at 0x00000140F67DF2D0>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\engine\base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x00000140F4B68B80>
    └ <sqlalchemy.engine.base.Connection object at 0x00000140F67DF2D0>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\engine\base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
          │                    │              │                 └ NotNullViolation('null value in column "fk_user_id" of relation "user_session" violates not-null constraint\nDETAIL:  Failing...
          │                    │              └ (<class 'psycopg2.errors.NotNullViolation'>, NotNullViolation('null value in column "fk_user_id" of relation "user_session" v...
          │                    └ <method 'with_traceback' of 'BaseException' objects>
          └ IntegrityError('(psycopg2.errors.NotNullViolation) null value in column "fk_user_id" of relation "user_session" violates not-...
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x00000140F4C2C360>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x00000140F4FF47D0>
    └ <sqlalchemy.engine.base.Connection object at 0x00000140F67DF2D0>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\engine\default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'fk_user_id': None, 'user_session_session_id': 15}
    │      │       └ 'UPDATE user_session SET fk_user_id=%(fk_user_id)s WHERE user_session.session_id = %(user_session_session_id)s'
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x00000140F680BBC0; closed: -1>

sqlalchemy.exc.IntegrityError: (psycopg2.errors.NotNullViolation) null value in column "fk_user_id" of relation "user_session" violates not-null constraint
DETAIL:  Failing row contains (15, 2024-11-06 13:16:04.68704+02, 127.0.0.1, null).

[SQL: UPDATE user_session SET fk_user_id=%(fk_user_id)s WHERE user_session.session_id = %(user_session_session_id)s]
[parameters: {'fk_user_id': None, 'user_session_session_id': 15}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2024-11-07 00:36:00.296 | INFO     | app.services.user_service:remove_user:121 - 
REMOVING USER ACCOUNT
2024-11-07 00:36:00.297 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:29 - Validating input
2024-11-07 00:36:00.298 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:60 - Input passed validation
2024-11-07 00:36:00.298 | INFO     | app.validators.user_validator:validate_username:17 - Validating username format
2024-11-07 00:36:00.298 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:29 - Validating input
2024-11-07 00:36:00.298 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:60 - Input passed validation
2024-11-07 00:36:00.299 | INFO     | app.validators.shared_validator:letters_numbers_only:17 - Validating input
2024-11-07 00:36:00.299 | INFO     | app.validators.shared_validator:letters_numbers_only:23 - Input passed validation
2024-11-07 00:36:00.299 | INFO     | app.validators.user_validator:validate_username:31 - Username validation passed
2024-11-07 00:36:00.299 | INFO     | app.validators.user_validator:validate_email:39 - Validating email format
2024-11-07 00:36:00.299 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:29 - Validating input
2024-11-07 00:36:00.299 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:60 - Input passed validation
2024-11-07 00:36:00.300 | INFO     | app.validators.user_validator:validate_email:54 - Email validation passed
2024-11-07 00:36:00.300 | INFO     | app.validators.user_validator:validate_password:62 - Validating password format
2024-11-07 00:36:00.300 | INFO     | app.validators.user_validator:validate_password:89 - Password validation passed
2024-11-07 00:36:00.300 | INFO     | app.crud.user_crud:get_authenticated_user:52 - Searching for user by specified username, email and password_hash
2024-11-07 00:36:00.321 | INFO     | app.crud.user_crud:get_authenticated_user:56 - User found
2024-11-07 00:36:00.326 | INFO     | app.crud.user_crud:delete:131 - Attempting to remove user account
2024-11-07 00:36:00.327 | INFO     | app.crud.user_crud:delete:139 - User prepared for account removal, waiting for transaction commit
2024-11-07 00:36:00.343 | ERROR    | app.services.user_service:remove_user:142 - 
USER ACCOUNT HAS NOT BEEN REMOVED, EXCEPTION OCCURED: (psycopg2.errors.NotNullViolation) null value in column "fk_user_id" of relation "user_session" violates not-null constraint
DETAIL:  Failing row contains (15, 2024-11-06 13:16:04.68704+02, 127.0.0.1, null).

[SQL: UPDATE user_session SET fk_user_id=%(fk_user_id)s WHERE user_session.session_id = %(user_session_session_id)s]
[parameters: {'fk_user_id': None, 'user_session_session_id': 15}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):

  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x00000274811EC360>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x00000274815B47D0>
    └ <sqlalchemy.engine.base.Connection object at 0x0000027482D9E910>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\engine\default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'fk_user_id': None, 'user_session_session_id': 15}
    │      │       └ 'UPDATE user_session SET fk_user_id=%(fk_user_id)s WHERE user_session.session_id = %(user_session_session_id)s'
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x0000027482DCFBC0; closed: -1>

psycopg2.errors.NotNullViolation: null value in column "fk_user_id" of relation "user_session" violates not-null constraint
DETAIL:  Failing row contains (15, 2024-11-06 13:16:04.68704+02, 127.0.0.1, null).



The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\threading.py", line 1002, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x00000274FD4B4860>
    └ <WorkerThread(AnyIO worker thread, started 32208)>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\threading.py", line 1045, in _bootstrap_inner
    self.run()
    │    └ <function WorkerThread.run at 0x0000027482CB84A0>
    └ <WorkerThread(AnyIO worker thread, started 32208)>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\anyio\_backends\_asyncio.py", line 914, in run
    result = context.run(func, *args)
             │       │   │      └ ()
             │       │   └ functools.partial(<function delete_user at 0x0000027482C12660>, db=<sqlalchemy.orm.session.Session object at 0x0000027482C4B8...
             │       └ <method 'run' of '_contextvars.Context' objects>
             └ <_contextvars.Context object at 0x0000027482CC2EC0>

  File "C:\Users\tomas\Documents\Saityno Progr. Projektavimas\StreamaBit\app\main.py", line 61, in delete_user
    return user_services.remove_user(db=db, username=username, data=data)
           │             │              │            │              └ UserDelete(email='firstUser55@gmail.com', password='Password1234$')
           │             │              │            └ 'First55Select'
           │             │              └ <sqlalchemy.orm.session.Session object at 0x0000027482C4B890>
           │             └ <function remove_user at 0x000002748289EC00>
           └ <module 'app.services.user_service' from 'C:\\Users\\tomas\\Documents\\Saityno Progr. Projektavimas\\StreamaBit\\app\\service...

> File "C:\Users\tomas\Documents\Saityno Progr. Projektavimas\StreamaBit\app\services\user_service.py", line 138, in remove_user
    shared_crud.commit(db)
    │           │      └ <sqlalchemy.orm.session.Session object at 0x0000027482C4B890>
    │           └ <function commit at 0x000002748289EA20>
    └ <module 'app.crud.shared_crud' from 'C:\\Users\\tomas\\Documents\\Saityno Progr. Projektavimas\\StreamaBit\\app\\crud\\shared...

  File "C:\Users\tomas\Documents\Saityno Progr. Projektavimas\StreamaBit\app\crud\shared_crud.py", line 7, in commit
    return db.commit()
           │  └ <function Session.commit at 0x00000274814B99E0>
           └ <sqlalchemy.orm.session.Session object at 0x0000027482C4B890>

  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\session.py", line 2028, in commit
    trans.commit(_to_root=True)
    │     └ <function SessionTransaction.commit at 0x00000274814B8AE0>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x0000027482C54DC0>
  File "<string>", line 2, in commit
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                │  │      │      └ {'_to_root': True}
                │  │      └ ()
                │  └ <sqlalchemy.orm.session.SessionTransaction object at 0x0000027482C54DC0>
                └ <function SessionTransaction.commit at 0x00000274814B8900>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\session.py", line 1313, in commit
    self._prepare_impl()
    │    └ <function SessionTransaction._prepare_impl at 0x00000274814B87C0>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x0000027482C54DC0>
  File "<string>", line 2, in _prepare_impl
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                │  │      │      └ {}
                │  │      └ ()
                │  └ <sqlalchemy.orm.session.SessionTransaction object at 0x0000027482C54DC0>
                └ <function SessionTransaction._prepare_impl at 0x00000274814B8720>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\session.py", line 1288, in _prepare_impl
    self.session.flush()
    │    │       └ <function Session.flush at 0x00000274814C4900>
    │    └ <sqlalchemy.orm.session.Session object at 0x0000027482C4B890>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x0000027482C54DC0>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\session.py", line 4352, in flush
    self._flush(objects)
    │    │      └ None
    │    └ <function Session._flush at 0x00000274814C4AE0>
    └ <sqlalchemy.orm.session.Session object at 0x0000027482C4B890>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\session.py", line 4487, in _flush
    with util.safe_reraise():
         │    └ <class 'sqlalchemy.util.langhelpers.safe_reraise'>
         └ <module 'sqlalchemy.util' from 'C:\\Users\\tomas\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\site-packages\\sqlalchemy...
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
          │         │              └ <traceback object at 0x0000027482C203C0>
          │         └ <method 'with_traceback' of 'BaseException' objects>
          └ IntegrityError('(psycopg2.errors.NotNullViolation) null value in column "fk_user_id" of relation "user_session" violates not-...
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\session.py", line 4448, in _flush
    flush_context.execute()
    │             └ <function UOWTransaction.execute at 0x00000274814A93A0>
    └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x0000027482D9DE90>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
    │   │       └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x0000027482D9DE90>
    │   └ <function SaveUpdateAll.execute at 0x00000274814A9EE0>
    └ SaveUpdateAll(Mapper[UserSession(user_session)])
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    │    │         │               └ <function save_obj at 0x0000027481455A80>
    │    │         └ <module 'sqlalchemy.orm.persistence' from 'C:\\Users\\tomas\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\site-packages\...
    │    └ <module 'sqlalchemy.util.preloaded' from 'C:\\Users\\tomas\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\site-packages\\...
    └ <module 'sqlalchemy.util' from 'C:\\Users\\tomas\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\site-packages\\sqlalchemy...
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\persistence.py", line 85, in save_obj
    _emit_update_statements(
    └ <function _emit_update_statements at 0x00000274814A00E0>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\persistence.py", line 912, in _emit_update_statements
    c = connection.execute(
        │          └ <function Connection.execute at 0x0000027481128360>
        └ <sqlalchemy.engine.base.Connection object at 0x0000027482D9E910>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\engine\base.py", line 1418, in execute
    return meth(
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.dml.Update object at 0x0000027482E16610>>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\sql\elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x0000027481128680>
           └ <sqlalchemy.engine.base.Connection object at 0x0000027482D9E910>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\engine\base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x0000027481128860>
          └ <sqlalchemy.engine.base.Connection object at 0x0000027482D9E910>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\engine\base.py", line 1846, in _execute_context
    return self._exec_single_context(
           │    └ <function Connection._exec_single_context at 0x0000027481128900>
           └ <sqlalchemy.engine.base.Connection object at 0x0000027482D9E910>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\engine\base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x0000027481128B80>
    └ <sqlalchemy.engine.base.Connection object at 0x0000027482D9E910>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\engine\base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
          │                    │              │                 └ NotNullViolation('null value in column "fk_user_id" of relation "user_session" violates not-null constraint\nDETAIL:  Failing...
          │                    │              └ (<class 'psycopg2.errors.NotNullViolation'>, NotNullViolation('null value in column "fk_user_id" of relation "user_session" v...
          │                    └ <method 'with_traceback' of 'BaseException' objects>
          └ IntegrityError('(psycopg2.errors.NotNullViolation) null value in column "fk_user_id" of relation "user_session" violates not-...
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x00000274811EC360>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x00000274815B47D0>
    └ <sqlalchemy.engine.base.Connection object at 0x0000027482D9E910>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\engine\default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'fk_user_id': None, 'user_session_session_id': 15}
    │      │       └ 'UPDATE user_session SET fk_user_id=%(fk_user_id)s WHERE user_session.session_id = %(user_session_session_id)s'
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x0000027482DCFBC0; closed: -1>

sqlalchemy.exc.IntegrityError: (psycopg2.errors.NotNullViolation) null value in column "fk_user_id" of relation "user_session" violates not-null constraint
DETAIL:  Failing row contains (15, 2024-11-06 13:16:04.68704+02, 127.0.0.1, null).

[SQL: UPDATE user_session SET fk_user_id=%(fk_user_id)s WHERE user_session.session_id = %(user_session_session_id)s]
[parameters: {'fk_user_id': None, 'user_session_session_id': 15}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2024-11-07 00:45:13.336 | INFO     | app.services.user_service:remove_user:121 - 
REMOVING USER ACCOUNT
2024-11-07 00:45:13.337 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:29 - Validating input
2024-11-07 00:45:13.337 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:60 - Input passed validation
2024-11-07 00:45:13.337 | INFO     | app.validators.user_validator:validate_username:17 - Validating username format
2024-11-07 00:45:13.337 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:29 - Validating input
2024-11-07 00:45:13.338 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:60 - Input passed validation
2024-11-07 00:45:13.338 | INFO     | app.validators.shared_validator:letters_numbers_only:17 - Validating input
2024-11-07 00:45:13.338 | INFO     | app.validators.shared_validator:letters_numbers_only:23 - Input passed validation
2024-11-07 00:45:13.338 | INFO     | app.validators.user_validator:validate_username:31 - Username validation passed
2024-11-07 00:45:13.338 | INFO     | app.validators.user_validator:validate_email:39 - Validating email format
2024-11-07 00:45:13.338 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:29 - Validating input
2024-11-07 00:45:13.339 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:60 - Input passed validation
2024-11-07 00:45:13.339 | INFO     | app.validators.user_validator:validate_email:54 - Email validation passed
2024-11-07 00:45:13.339 | INFO     | app.validators.user_validator:validate_password:62 - Validating password format
2024-11-07 00:45:13.339 | INFO     | app.validators.user_validator:validate_password:89 - Password validation passed
2024-11-07 00:45:13.339 | INFO     | app.crud.user_crud:get_authenticated_user:52 - Searching for user by specified username, email and password_hash
2024-11-07 00:45:13.362 | INFO     | app.crud.user_crud:get_authenticated_user:56 - User found
2024-11-07 00:45:13.367 | INFO     | app.crud.user_crud:delete:131 - Attempting to remove user account
2024-11-07 00:45:13.368 | INFO     | app.crud.user_crud:delete:139 - User prepared for account removal, waiting for transaction commit
2024-11-07 00:45:13.387 | ERROR    | app.services.user_service:remove_user:142 - 
USER ACCOUNT HAS NOT BEEN REMOVED, EXCEPTION OCCURED: (psycopg2.errors.NotNullViolation) null value in column "fk_user_id" of relation "user_session" violates not-null constraint
DETAIL:  Failing row contains (15, 2024-11-06 13:16:04.68704+02, 127.0.0.1, null).

[SQL: UPDATE user_session SET fk_user_id=%(fk_user_id)s WHERE user_session.session_id = %(user_session_session_id)s]
[parameters: {'fk_user_id': None, 'user_session_session_id': 15}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):

  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x000002D26BF0C360>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x000002D26C2D47D0>
    └ <sqlalchemy.engine.base.Connection object at 0x000002D26DABE610>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\engine\default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'fk_user_id': None, 'user_session_session_id': 15}
    │      │       └ 'UPDATE user_session SET fk_user_id=%(fk_user_id)s WHERE user_session.session_id = %(user_session_session_id)s'
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x000002D26DAEBBC0; closed: -1>

psycopg2.errors.NotNullViolation: null value in column "fk_user_id" of relation "user_session" violates not-null constraint
DETAIL:  Failing row contains (15, 2024-11-06 13:16:04.68704+02, 127.0.0.1, null).



The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\threading.py", line 1002, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x000002D268164860>
    └ <WorkerThread(AnyIO worker thread, started 12764)>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\threading.py", line 1045, in _bootstrap_inner
    self.run()
    │    └ <function WorkerThread.run at 0x000002D26D9DC4A0>
    └ <WorkerThread(AnyIO worker thread, started 12764)>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\anyio\_backends\_asyncio.py", line 914, in run
    result = context.run(func, *args)
             │       │   │      └ ()
             │       │   └ functools.partial(<function delete_user at 0x000002D26D932660>, db=<sqlalchemy.orm.session.Session object at 0x000002D26D98B1...
             │       └ <method 'run' of '_contextvars.Context' objects>
             └ <_contextvars.Context object at 0x000002D26D98B2C0>

  File "C:\Users\tomas\Documents\Saityno Progr. Projektavimas\StreamaBit\app\main.py", line 61, in delete_user
    return user_services.remove_user(db=db, username=username, data=data)
           │             │              │            │              └ UserDelete(email='firstUser55@gmail.com', password='Password1234$')
           │             │              │            └ 'First55Select'
           │             │              └ <sqlalchemy.orm.session.Session object at 0x000002D26D98B110>
           │             └ <function remove_user at 0x000002D26D5BEC00>
           └ <module 'app.services.user_service' from 'C:\\Users\\tomas\\Documents\\Saityno Progr. Projektavimas\\StreamaBit\\app\\service...

> File "C:\Users\tomas\Documents\Saityno Progr. Projektavimas\StreamaBit\app\services\user_service.py", line 138, in remove_user
    shared_crud.commit(db)
    │           │      └ <sqlalchemy.orm.session.Session object at 0x000002D26D98B110>
    │           └ <function commit at 0x000002D26D5BEA20>
    └ <module 'app.crud.shared_crud' from 'C:\\Users\\tomas\\Documents\\Saityno Progr. Projektavimas\\StreamaBit\\app\\crud\\shared...

  File "C:\Users\tomas\Documents\Saityno Progr. Projektavimas\StreamaBit\app\crud\shared_crud.py", line 7, in commit
    return db.commit()
           │  └ <function Session.commit at 0x000002D26C1D99E0>
           └ <sqlalchemy.orm.session.Session object at 0x000002D26D98B110>

  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\session.py", line 2028, in commit
    trans.commit(_to_root=True)
    │     └ <function SessionTransaction.commit at 0x000002D26C1D8AE0>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x000002D26DA710E0>
  File "<string>", line 2, in commit
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                │  │      │      └ {'_to_root': True}
                │  │      └ ()
                │  └ <sqlalchemy.orm.session.SessionTransaction object at 0x000002D26DA710E0>
                └ <function SessionTransaction.commit at 0x000002D26C1D8900>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\session.py", line 1313, in commit
    self._prepare_impl()
    │    └ <function SessionTransaction._prepare_impl at 0x000002D26C1D87C0>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x000002D26DA710E0>
  File "<string>", line 2, in _prepare_impl
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                │  │      │      └ {}
                │  │      └ ()
                │  └ <sqlalchemy.orm.session.SessionTransaction object at 0x000002D26DA710E0>
                └ <function SessionTransaction._prepare_impl at 0x000002D26C1D8720>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\session.py", line 1288, in _prepare_impl
    self.session.flush()
    │    │       └ <function Session.flush at 0x000002D26C1E4900>
    │    └ <sqlalchemy.orm.session.Session object at 0x000002D26D98B110>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x000002D26DA710E0>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\session.py", line 4352, in flush
    self._flush(objects)
    │    │      └ None
    │    └ <function Session._flush at 0x000002D26C1E4AE0>
    └ <sqlalchemy.orm.session.Session object at 0x000002D26D98B110>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\session.py", line 4487, in _flush
    with util.safe_reraise():
         │    └ <class 'sqlalchemy.util.langhelpers.safe_reraise'>
         └ <module 'sqlalchemy.util' from 'C:\\Users\\tomas\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\site-packages\\sqlalchemy...
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
          │         │              └ <traceback object at 0x000002D26DB2F300>
          │         └ <method 'with_traceback' of 'BaseException' objects>
          └ IntegrityError('(psycopg2.errors.NotNullViolation) null value in column "fk_user_id" of relation "user_session" violates not-...
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\session.py", line 4448, in _flush
    flush_context.execute()
    │             └ <function UOWTransaction.execute at 0x000002D26C1C93A0>
    └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x000002D26DACFC90>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
    │   │       └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x000002D26DACFC90>
    │   └ <function SaveUpdateAll.execute at 0x000002D26C1C9EE0>
    └ SaveUpdateAll(Mapper[UserSession(user_session)])
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    │    │         │               └ <function save_obj at 0x000002D26C175A80>
    │    │         └ <module 'sqlalchemy.orm.persistence' from 'C:\\Users\\tomas\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\site-packages\...
    │    └ <module 'sqlalchemy.util.preloaded' from 'C:\\Users\\tomas\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\site-packages\\...
    └ <module 'sqlalchemy.util' from 'C:\\Users\\tomas\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\site-packages\\sqlalchemy...
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\persistence.py", line 85, in save_obj
    _emit_update_statements(
    └ <function _emit_update_statements at 0x000002D26C1C00E0>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\persistence.py", line 912, in _emit_update_statements
    c = connection.execute(
        │          └ <function Connection.execute at 0x000002D26BE48360>
        └ <sqlalchemy.engine.base.Connection object at 0x000002D26DABE610>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\engine\base.py", line 1418, in execute
    return meth(
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.dml.Update object at 0x000002D26DB2E810>>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\sql\elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x000002D26BE48680>
           └ <sqlalchemy.engine.base.Connection object at 0x000002D26DABE610>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\engine\base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x000002D26BE48860>
          └ <sqlalchemy.engine.base.Connection object at 0x000002D26DABE610>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\engine\base.py", line 1846, in _execute_context
    return self._exec_single_context(
           │    └ <function Connection._exec_single_context at 0x000002D26BE48900>
           └ <sqlalchemy.engine.base.Connection object at 0x000002D26DABE610>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\engine\base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x000002D26BE48B80>
    └ <sqlalchemy.engine.base.Connection object at 0x000002D26DABE610>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\engine\base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
          │                    │              │                 └ NotNullViolation('null value in column "fk_user_id" of relation "user_session" violates not-null constraint\nDETAIL:  Failing...
          │                    │              └ (<class 'psycopg2.errors.NotNullViolation'>, NotNullViolation('null value in column "fk_user_id" of relation "user_session" v...
          │                    └ <method 'with_traceback' of 'BaseException' objects>
          └ IntegrityError('(psycopg2.errors.NotNullViolation) null value in column "fk_user_id" of relation "user_session" violates not-...
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x000002D26BF0C360>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x000002D26C2D47D0>
    └ <sqlalchemy.engine.base.Connection object at 0x000002D26DABE610>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\engine\default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'fk_user_id': None, 'user_session_session_id': 15}
    │      │       └ 'UPDATE user_session SET fk_user_id=%(fk_user_id)s WHERE user_session.session_id = %(user_session_session_id)s'
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x000002D26DAEBBC0; closed: -1>

sqlalchemy.exc.IntegrityError: (psycopg2.errors.NotNullViolation) null value in column "fk_user_id" of relation "user_session" violates not-null constraint
DETAIL:  Failing row contains (15, 2024-11-06 13:16:04.68704+02, 127.0.0.1, null).

[SQL: UPDATE user_session SET fk_user_id=%(fk_user_id)s WHERE user_session.session_id = %(user_session_session_id)s]
[parameters: {'fk_user_id': None, 'user_session_session_id': 15}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2024-11-07 00:45:22.673 | INFO     | app.services.user_service:remove_user:121 - 
REMOVING USER ACCOUNT
2024-11-07 00:45:22.674 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:29 - Validating input
2024-11-07 00:45:22.674 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:60 - Input passed validation
2024-11-07 00:45:22.675 | INFO     | app.validators.user_validator:validate_username:17 - Validating username format
2024-11-07 00:45:22.675 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:29 - Validating input
2024-11-07 00:45:22.675 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:60 - Input passed validation
2024-11-07 00:45:22.675 | INFO     | app.validators.shared_validator:letters_numbers_only:17 - Validating input
2024-11-07 00:45:22.675 | INFO     | app.validators.shared_validator:letters_numbers_only:23 - Input passed validation
2024-11-07 00:45:22.675 | INFO     | app.validators.user_validator:validate_username:31 - Username validation passed
2024-11-07 00:45:22.676 | INFO     | app.validators.user_validator:validate_email:39 - Validating email format
2024-11-07 00:45:22.676 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:29 - Validating input
2024-11-07 00:45:22.676 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:60 - Input passed validation
2024-11-07 00:45:22.677 | INFO     | app.validators.user_validator:validate_email:54 - Email validation passed
2024-11-07 00:45:22.677 | INFO     | app.validators.user_validator:validate_password:62 - Validating password format
2024-11-07 00:45:22.677 | INFO     | app.validators.user_validator:validate_password:89 - Password validation passed
2024-11-07 00:45:22.677 | INFO     | app.crud.user_crud:get_authenticated_user:52 - Searching for user by specified username, email and password_hash
2024-11-07 00:45:22.681 | ERROR    | app.crud.user_crud:get_authenticated_user:64 - Exception with username=First55Select, email=firstUser55@gmail.com: Could not determine join condition between parent/child tables on relationship User.sessions - there are no foreign keys linking these tables.  Ensure that referencing columns are associated with a ForeignKey or ForeignKeyConstraint, or specify a 'primaryjoin' expression.
Traceback (most recent call last):

  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\relationships.py", line 2423, in _determine_joins
    self.primaryjoin = join_condition(
    │                  └ <function join_condition at 0x0000015939BE2480>
    └ <sqlalchemy.orm.relationships.JoinCondition object at 0x000001593BA3B650>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\sql\util.py", line 123, in join_condition
    return Join._join_condition(
           │    └ <classmethod(<function Join._join_condition at 0x0000015939DAC9A0>)>
           └ <class 'sqlalchemy.sql.selectable.Join'>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\sql\selectable.py", line 1380, in _join_condition
    raise exc.NoForeignKeysError(
          │   └ <class 'sqlalchemy.exc.NoForeignKeysError'>
          └ <module 'sqlalchemy.exc' from 'C:\\Users\\tomas\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\site-packages\\sqlalchemy\...

sqlalchemy.exc.NoForeignKeysError: Can't find any foreign key relationships between 'user' and 'user_session'.


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\threading.py", line 1002, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x00000159361E4860>
    └ <WorkerThread(AnyIO worker thread, started 31204)>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\threading.py", line 1045, in _bootstrap_inner
    self.run()
    │    └ <function WorkerThread.run at 0x000001593BA2C400>
    └ <WorkerThread(AnyIO worker thread, started 31204)>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\anyio\_backends\_asyncio.py", line 914, in run
    result = context.run(func, *args)
             │       │   │      └ ()
             │       │   └ functools.partial(<function delete_user at 0x000001593B9825C0>, db=<sqlalchemy.orm.session.Session object at 0x000001593B9DB3...
             │       └ <method 'run' of '_contextvars.Context' objects>
             └ <_contextvars.Context object at 0x000001593B986700>

  File "C:\Users\tomas\Documents\Saityno Progr. Projektavimas\StreamaBit\app\main.py", line 61, in delete_user
    return user_services.remove_user(db=db, username=username, data=data)
           │             │              │            │              └ UserDelete(email='firstUser55@gmail.com', password='Password1234$')
           │             │              │            └ 'First55Select'
           │             │              └ <sqlalchemy.orm.session.Session object at 0x000001593B9DB310>
           │             └ <function remove_user at 0x000001593B60EB60>
           └ <module 'app.services.user_service' from 'C:\\Users\\tomas\\Documents\\Saityno Progr. Projektavimas\\StreamaBit\\app\\service...

  File "C:\Users\tomas\Documents\Saityno Progr. Projektavimas\StreamaBit\app\services\user_service.py", line 128, in remove_user
    db_user = user_crud.get_authenticated_user(db=db, username=username, email=data.email, password_hash=data.password)
              │         │                         │            │               │    │                    │    └ 'Password1234$'
              │         │                         │            │               │    │                    └ UserDelete(email='firstUser55@gmail.com', password='Password1234$')
              │         │                         │            │               │    └ 'firstUser55@gmail.com'
              │         │                         │            │               └ UserDelete(email='firstUser55@gmail.com', password='Password1234$')
              │         │                         │            └ 'First55Select'
              │         │                         └ <sqlalchemy.orm.session.Session object at 0x000001593B9DB310>
              │         └ <function get_authenticated_user at 0x000001593B60E5C0>
              └ <module 'app.crud.user_crud' from 'C:\\Users\\tomas\\Documents\\Saityno Progr. Projektavimas\\StreamaBit\\app\\crud\\user_cru...

> File "C:\Users\tomas\Documents\Saityno Progr. Projektavimas\StreamaBit\app\crud\user_crud.py", line 53, in get_authenticated_user
    query = db.query(models.User)
            │  │     │      └ <class 'app.models.database.User'>
            │  │     └ <module 'app.models.database' from 'C:\\Users\\tomas\\Documents\\Saityno Progr. Projektavimas\\StreamaBit\\app\\models\\datab...
            │  └ <function Session.query at 0x000001593A22B2E0>
            └ <sqlalchemy.orm.session.Session object at 0x000001593B9DB310>

  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\session.py", line 2952, in query
    return self._query_cls(entities, self, **kwargs)
           │    │          │         │       └ {}
           │    │          │         └ <sqlalchemy.orm.session.Session object at 0x000001593B9DB310>
           │    │          └ (<class 'app.models.database.User'>,)
           │    └ <class 'sqlalchemy.orm.query.Query'>
           └ <sqlalchemy.orm.session.Session object at 0x000001593B9DB310>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\query.py", line 275, in __init__
    self._set_entities(entities)
    │    │             └ (<class 'app.models.database.User'>,)
    │    └ <function Query._set_entities at 0x000001593A164F40>
    └ <sqlalchemy.orm.query.Query object at 0x000001593B9970D0>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\query.py", line 287, in _set_entities
    self._raw_columns = [
    └ <sqlalchemy.orm.query.Query object at 0x000001593B9970D0>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\query.py", line 288, in <listcomp>
    coercions.expect(
    │         └ <function expect at 0x0000015939BAC220>
    └ <module 'sqlalchemy.sql.coercions' from 'C:\\Users\\tomas\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\site-packages\\s...
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\sql\coercions.py", line 389, in expect
    insp._post_inspect
    │    └ <sqlalchemy.util.langhelpers.HasMemoized.memoized_attribute object at 0x000001593A15D510>
    └ <Mapper at 0x159398b7910; User>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 1253, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
    │   │        │    │                    │    │    └ <Mapper at 0x159398b7910; User>
    │   │        │    │                    │    └ <function Mapper._post_inspect at 0x000001593A1611C0>
    │   │        │    │                    └ <sqlalchemy.util.langhelpers.HasMemoized.memoized_attribute object at 0x000001593A15D510>
    │   │        │    └ '_post_inspect'
    │   │        └ <sqlalchemy.util.langhelpers.HasMemoized.memoized_attribute object at 0x000001593A15D510>
    │   └ <attribute '__dict__' of 'Mapper' objects>
    └ <Mapper at 0x159398b7910; User>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2711, in _post_inspect
    self._check_configure()
    │    └ <function Mapper._check_configure at 0x000001593A160400>
    └ <Mapper at 0x159398b7910; User>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2388, in _check_configure
    _configure_registries({self.registry}, cascade=True)
    │                      │    └ <sqlalchemy.orm.decl_api.registry object at 0x000001593A4C13D0>
    │                      └ <Mapper at 0x159398b7910; User>
    └ <function _configure_registries at 0x000001593A1640E0>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4204, in _configure_registries
    _do_configure_registries(registries, cascade)
    │                        │           └ True
    │                        └ set()
    └ <function _do_configure_registries at 0x000001593A164220>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4245, in _do_configure_registries
    mapper._post_configure_properties()
    │      └ <function Mapper._post_configure_properties at 0x000001593A1602C0>
    └ <Mapper at 0x159398b7910; User>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2405, in _post_configure_properties
    prop.init()
    │    └ <function MapperProperty.init at 0x000001593A020C20>
    └ <_RelationshipDeclared at 0x1593a4f5270; sessions>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\interfaces.py", line 584, in init
    self.do_init()
    │    └ <function RelationshipProperty.do_init at 0x000001593A132B60>
    └ <_RelationshipDeclared at 0x1593a4f5270; sessions>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\relationships.py", line 1644, in do_init
    self._setup_join_conditions()
    │    └ <function RelationshipProperty._setup_join_conditions at 0x000001593A132DE0>
    └ <_RelationshipDeclared at 0x1593a4f5270; sessions>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\relationships.py", line 1884, in _setup_join_conditions
    self._join_condition = jc = JoinCondition(
    │                           └ <class 'sqlalchemy.orm.relationships.JoinCondition'>
    └ <_RelationshipDeclared at 0x1593a4f5270; sessions>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\relationships.py", line 2310, in __init__
    self._determine_joins()
    │    └ <function JoinCondition._determine_joins at 0x000001593A133E20>
    └ <sqlalchemy.orm.relationships.JoinCondition object at 0x000001593BA3B650>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\relationships.py", line 2444, in _determine_joins
    raise sa_exc.NoForeignKeysError(
          │      └ <class 'sqlalchemy.exc.NoForeignKeysError'>
          └ <module 'sqlalchemy.exc' from 'C:\\Users\\tomas\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\site-packages\\sqlalchemy\...

sqlalchemy.exc.NoForeignKeysError: Could not determine join condition between parent/child tables on relationship User.sessions - there are no foreign keys linking these tables.  Ensure that referencing columns are associated with a ForeignKey or ForeignKeyConstraint, or specify a 'primaryjoin' expression.
2024-11-07 00:45:22.770 | ERROR    | app.services.user_service:remove_user:142 - 
USER ACCOUNT HAS NOT BEEN REMOVED, EXCEPTION OCCURED: 500: An unexpected error occurred
Traceback (most recent call last):

  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\relationships.py", line 2423, in _determine_joins
    self.primaryjoin = join_condition(
    │                  └ <function join_condition at 0x0000015939BE2480>
    └ <sqlalchemy.orm.relationships.JoinCondition object at 0x000001593BA3B650>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\sql\util.py", line 123, in join_condition
    return Join._join_condition(
           │    └ <classmethod(<function Join._join_condition at 0x0000015939DAC9A0>)>
           └ <class 'sqlalchemy.sql.selectable.Join'>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\sql\selectable.py", line 1380, in _join_condition
    raise exc.NoForeignKeysError(
          │   └ <class 'sqlalchemy.exc.NoForeignKeysError'>
          └ <module 'sqlalchemy.exc' from 'C:\\Users\\tomas\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\site-packages\\sqlalchemy\...

sqlalchemy.exc.NoForeignKeysError: Can't find any foreign key relationships between 'user' and 'user_session'.


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "C:\Users\tomas\Documents\Saityno Progr. Projektavimas\StreamaBit\app\crud\user_crud.py", line 53, in get_authenticated_user
    query = db.query(models.User)
            │  │     │      └ <class 'app.models.database.User'>
            │  │     └ <module 'app.models.database' from 'C:\\Users\\tomas\\Documents\\Saityno Progr. Projektavimas\\StreamaBit\\app\\models\\datab...
            │  └ <function Session.query at 0x000001593A22B2E0>
            └ <sqlalchemy.orm.session.Session object at 0x000001593B9DB310>

  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\session.py", line 2952, in query
    return self._query_cls(entities, self, **kwargs)
           │    │          │         │       └ {}
           │    │          │         └ <sqlalchemy.orm.session.Session object at 0x000001593B9DB310>
           │    │          └ (<class 'app.models.database.User'>,)
           │    └ <class 'sqlalchemy.orm.query.Query'>
           └ <sqlalchemy.orm.session.Session object at 0x000001593B9DB310>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\query.py", line 275, in __init__
    self._set_entities(entities)
    │    │             └ (<class 'app.models.database.User'>,)
    │    └ <function Query._set_entities at 0x000001593A164F40>
    └ <sqlalchemy.orm.query.Query object at 0x000001593B9970D0>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\query.py", line 287, in _set_entities
    self._raw_columns = [
    └ <sqlalchemy.orm.query.Query object at 0x000001593B9970D0>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\query.py", line 288, in <listcomp>
    coercions.expect(
    │         └ <function expect at 0x0000015939BAC220>
    └ <module 'sqlalchemy.sql.coercions' from 'C:\\Users\\tomas\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\site-packages\\s...
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\sql\coercions.py", line 389, in expect
    insp._post_inspect
    │    └ <sqlalchemy.util.langhelpers.HasMemoized.memoized_attribute object at 0x000001593A15D510>
    └ <Mapper at 0x159398b7910; User>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 1253, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
    │   │        │    │                    │    │    └ <Mapper at 0x159398b7910; User>
    │   │        │    │                    │    └ <function Mapper._post_inspect at 0x000001593A1611C0>
    │   │        │    │                    └ <sqlalchemy.util.langhelpers.HasMemoized.memoized_attribute object at 0x000001593A15D510>
    │   │        │    └ '_post_inspect'
    │   │        └ <sqlalchemy.util.langhelpers.HasMemoized.memoized_attribute object at 0x000001593A15D510>
    │   └ <attribute '__dict__' of 'Mapper' objects>
    └ <Mapper at 0x159398b7910; User>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2711, in _post_inspect
    self._check_configure()
    │    └ <function Mapper._check_configure at 0x000001593A160400>
    └ <Mapper at 0x159398b7910; User>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2388, in _check_configure
    _configure_registries({self.registry}, cascade=True)
    │                      │    └ <sqlalchemy.orm.decl_api.registry object at 0x000001593A4C13D0>
    │                      └ <Mapper at 0x159398b7910; User>
    └ <function _configure_registries at 0x000001593A1640E0>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4204, in _configure_registries
    _do_configure_registries(registries, cascade)
    │                        │           └ True
    │                        └ set()
    └ <function _do_configure_registries at 0x000001593A164220>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4245, in _do_configure_registries
    mapper._post_configure_properties()
    │      └ <function Mapper._post_configure_properties at 0x000001593A1602C0>
    └ <Mapper at 0x159398b7910; User>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2405, in _post_configure_properties
    prop.init()
    │    └ <function MapperProperty.init at 0x000001593A020C20>
    └ <_RelationshipDeclared at 0x1593a4f5270; sessions>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\interfaces.py", line 584, in init
    self.do_init()
    │    └ <function RelationshipProperty.do_init at 0x000001593A132B60>
    └ <_RelationshipDeclared at 0x1593a4f5270; sessions>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\relationships.py", line 1644, in do_init
    self._setup_join_conditions()
    │    └ <function RelationshipProperty._setup_join_conditions at 0x000001593A132DE0>
    └ <_RelationshipDeclared at 0x1593a4f5270; sessions>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\relationships.py", line 1884, in _setup_join_conditions
    self._join_condition = jc = JoinCondition(
    │                           └ <class 'sqlalchemy.orm.relationships.JoinCondition'>
    └ <_RelationshipDeclared at 0x1593a4f5270; sessions>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\relationships.py", line 2310, in __init__
    self._determine_joins()
    │    └ <function JoinCondition._determine_joins at 0x000001593A133E20>
    └ <sqlalchemy.orm.relationships.JoinCondition object at 0x000001593BA3B650>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\relationships.py", line 2444, in _determine_joins
    raise sa_exc.NoForeignKeysError(
          │      └ <class 'sqlalchemy.exc.NoForeignKeysError'>
          └ <module 'sqlalchemy.exc' from 'C:\\Users\\tomas\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\site-packages\\sqlalchemy\...

sqlalchemy.exc.NoForeignKeysError: Could not determine join condition between parent/child tables on relationship User.sessions - there are no foreign keys linking these tables.  Ensure that referencing columns are associated with a ForeignKey or ForeignKeyConstraint, or specify a 'primaryjoin' expression.


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\threading.py", line 1002, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x00000159361E4860>
    └ <WorkerThread(AnyIO worker thread, started 31204)>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\threading.py", line 1045, in _bootstrap_inner
    self.run()
    │    └ <function WorkerThread.run at 0x000001593BA2C400>
    └ <WorkerThread(AnyIO worker thread, started 31204)>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\anyio\_backends\_asyncio.py", line 914, in run
    result = context.run(func, *args)
             │       │   │      └ ()
             │       │   └ functools.partial(<function delete_user at 0x000001593B9825C0>, db=<sqlalchemy.orm.session.Session object at 0x000001593B9DB3...
             │       └ <method 'run' of '_contextvars.Context' objects>
             └ <_contextvars.Context object at 0x000001593B986700>

  File "C:\Users\tomas\Documents\Saityno Progr. Projektavimas\StreamaBit\app\main.py", line 61, in delete_user
    return user_services.remove_user(db=db, username=username, data=data)
           │             │              │            │              └ UserDelete(email='firstUser55@gmail.com', password='Password1234$')
           │             │              │            └ 'First55Select'
           │             │              └ <sqlalchemy.orm.session.Session object at 0x000001593B9DB310>
           │             └ <function remove_user at 0x000001593B60EB60>
           └ <module 'app.services.user_service' from 'C:\\Users\\tomas\\Documents\\Saityno Progr. Projektavimas\\StreamaBit\\app\\service...

> File "C:\Users\tomas\Documents\Saityno Progr. Projektavimas\StreamaBit\app\services\user_service.py", line 128, in remove_user
    db_user = user_crud.get_authenticated_user(db=db, username=username, email=data.email, password_hash=data.password)
              │         │                         │            │               │    │                    │    └ 'Password1234$'
              │         │                         │            │               │    │                    └ UserDelete(email='firstUser55@gmail.com', password='Password1234$')
              │         │                         │            │               │    └ 'firstUser55@gmail.com'
              │         │                         │            │               └ UserDelete(email='firstUser55@gmail.com', password='Password1234$')
              │         │                         │            └ 'First55Select'
              │         │                         └ <sqlalchemy.orm.session.Session object at 0x000001593B9DB310>
              │         └ <function get_authenticated_user at 0x000001593B60E5C0>
              └ <module 'app.crud.user_crud' from 'C:\\Users\\tomas\\Documents\\Saityno Progr. Projektavimas\\StreamaBit\\app\\crud\\user_cru...

  File "C:\Users\tomas\Documents\Saityno Progr. Projektavimas\StreamaBit\app\crud\user_crud.py", line 65, in get_authenticated_user
    raise HTTPException(status_code=500, detail="An unexpected error occurred")
          └ <class 'fastapi.exceptions.HTTPException'>

fastapi.exceptions.HTTPException: 500: An unexpected error occurred
2024-11-07 00:46:13.250 | INFO     | app.services.user_service:remove_user:121 - 
REMOVING USER ACCOUNT
2024-11-07 00:46:13.251 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:29 - Validating input
2024-11-07 00:46:13.251 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:60 - Input passed validation
2024-11-07 00:46:13.251 | INFO     | app.validators.user_validator:validate_username:17 - Validating username format
2024-11-07 00:46:13.252 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:29 - Validating input
2024-11-07 00:46:13.252 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:60 - Input passed validation
2024-11-07 00:46:13.252 | INFO     | app.validators.shared_validator:letters_numbers_only:17 - Validating input
2024-11-07 00:46:13.252 | INFO     | app.validators.shared_validator:letters_numbers_only:23 - Input passed validation
2024-11-07 00:46:13.253 | INFO     | app.validators.user_validator:validate_username:31 - Username validation passed
2024-11-07 00:46:13.253 | INFO     | app.validators.user_validator:validate_email:39 - Validating email format
2024-11-07 00:46:13.253 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:29 - Validating input
2024-11-07 00:46:13.253 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:60 - Input passed validation
2024-11-07 00:46:13.253 | INFO     | app.validators.user_validator:validate_email:54 - Email validation passed
2024-11-07 00:46:13.254 | INFO     | app.validators.user_validator:validate_password:62 - Validating password format
2024-11-07 00:46:13.254 | INFO     | app.validators.user_validator:validate_password:89 - Password validation passed
2024-11-07 00:46:13.254 | INFO     | app.crud.user_crud:get_authenticated_user:52 - Searching for user by specified username, email and password_hash
2024-11-07 00:46:13.276 | INFO     | app.crud.user_crud:get_authenticated_user:56 - User found
2024-11-07 00:46:13.281 | INFO     | app.crud.user_crud:delete:131 - Attempting to remove user account
2024-11-07 00:46:13.283 | INFO     | app.crud.user_crud:delete:139 - User prepared for account removal, waiting for transaction commit
2024-11-07 00:46:13.299 | ERROR    | app.services.user_service:remove_user:142 - 
USER ACCOUNT HAS NOT BEEN REMOVED, EXCEPTION OCCURED: (psycopg2.errors.NotNullViolation) null value in column "fk_user_id" of relation "user_session" violates not-null constraint
DETAIL:  Failing row contains (15, 2024-11-06 13:16:04.68704+02, 127.0.0.1, null).

[SQL: UPDATE user_session SET fk_user_id=%(fk_user_id)s WHERE user_session.session_id = %(user_session_session_id)s]
[parameters: {'fk_user_id': None, 'user_session_session_id': 15}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):

  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x000001F5368AC360>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x000001F536C74850>
    └ <sqlalchemy.engine.base.Connection object at 0x000001F53845EE50>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\engine\default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'fk_user_id': None, 'user_session_session_id': 15}
    │      │       └ 'UPDATE user_session SET fk_user_id=%(fk_user_id)s WHERE user_session.session_id = %(user_session_session_id)s'
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x000001F53848FBC0; closed: -1>

psycopg2.errors.NotNullViolation: null value in column "fk_user_id" of relation "user_session" violates not-null constraint
DETAIL:  Failing row contains (15, 2024-11-06 13:16:04.68704+02, 127.0.0.1, null).



The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\threading.py", line 1002, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x000001F532AE4860>
    └ <WorkerThread(AnyIO worker thread, started 16656)>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\threading.py", line 1045, in _bootstrap_inner
    self.run()
    │    └ <function WorkerThread.run at 0x000001F5383784A0>
    └ <WorkerThread(AnyIO worker thread, started 16656)>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\anyio\_backends\_asyncio.py", line 914, in run
    result = context.run(func, *args)
             │       │   │      └ ()
             │       │   └ functools.partial(<function delete_user at 0x000001F5382D2660>, db=<sqlalchemy.orm.session.Session object at 0x000001F53830B8...
             │       └ <method 'run' of '_contextvars.Context' objects>
             └ <_contextvars.Context object at 0x000001F5383275C0>

  File "C:\Users\tomas\Documents\Saityno Progr. Projektavimas\StreamaBit\app\main.py", line 61, in delete_user
    return user_services.remove_user(db=db, username=username, data=data)
           │             │              │            │              └ UserDelete(email='firstUser55@gmail.com', password='Password1234$')
           │             │              │            └ 'First55Select'
           │             │              └ <sqlalchemy.orm.session.Session object at 0x000001F53830B890>
           │             └ <function remove_user at 0x000001F537F5EC00>
           └ <module 'app.services.user_service' from 'C:\\Users\\tomas\\Documents\\Saityno Progr. Projektavimas\\StreamaBit\\app\\service...

> File "C:\Users\tomas\Documents\Saityno Progr. Projektavimas\StreamaBit\app\services\user_service.py", line 138, in remove_user
    shared_crud.commit(db)
    │           │      └ <sqlalchemy.orm.session.Session object at 0x000001F53830B890>
    │           └ <function commit at 0x000001F537F5EA20>
    └ <module 'app.crud.shared_crud' from 'C:\\Users\\tomas\\Documents\\Saityno Progr. Projektavimas\\StreamaBit\\app\\crud\\shared...

  File "C:\Users\tomas\Documents\Saityno Progr. Projektavimas\StreamaBit\app\crud\shared_crud.py", line 7, in commit
    return db.commit()
           │  └ <function Session.commit at 0x000001F536B799E0>
           └ <sqlalchemy.orm.session.Session object at 0x000001F53830B890>

  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\session.py", line 2028, in commit
    trans.commit(_to_root=True)
    │     └ <function SessionTransaction.commit at 0x000001F536B78AE0>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x000001F5382F10E0>
  File "<string>", line 2, in commit
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                │  │      │      └ {'_to_root': True}
                │  │      └ ()
                │  └ <sqlalchemy.orm.session.SessionTransaction object at 0x000001F5382F10E0>
                └ <function SessionTransaction.commit at 0x000001F536B78900>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\session.py", line 1313, in commit
    self._prepare_impl()
    │    └ <function SessionTransaction._prepare_impl at 0x000001F536B787C0>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x000001F5382F10E0>
  File "<string>", line 2, in _prepare_impl
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                │  │      │      └ {}
                │  │      └ ()
                │  └ <sqlalchemy.orm.session.SessionTransaction object at 0x000001F5382F10E0>
                └ <function SessionTransaction._prepare_impl at 0x000001F536B78720>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\session.py", line 1288, in _prepare_impl
    self.session.flush()
    │    │       └ <function Session.flush at 0x000001F536B84900>
    │    └ <sqlalchemy.orm.session.Session object at 0x000001F53830B890>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x000001F5382F10E0>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\session.py", line 4352, in flush
    self._flush(objects)
    │    │      └ None
    │    └ <function Session._flush at 0x000001F536B84AE0>
    └ <sqlalchemy.orm.session.Session object at 0x000001F53830B890>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\session.py", line 4487, in _flush
    with util.safe_reraise():
         │    └ <class 'sqlalchemy.util.langhelpers.safe_reraise'>
         └ <module 'sqlalchemy.util' from 'C:\\Users\\tomas\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\site-packages\\sqlalchemy...
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
          │         │              └ <traceback object at 0x000001F5384D3400>
          │         └ <method 'with_traceback' of 'BaseException' objects>
          └ IntegrityError('(psycopg2.errors.NotNullViolation) null value in column "fk_user_id" of relation "user_session" violates not-...
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\session.py", line 4448, in _flush
    flush_context.execute()
    │             └ <function UOWTransaction.execute at 0x000001F536B693A0>
    └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x000001F53846F7D0>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
    │   │       └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x000001F53846F7D0>
    │   └ <function SaveUpdateAll.execute at 0x000001F536B69EE0>
    └ SaveUpdateAll(Mapper[UserSession(user_session)])
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    │    │         │               └ <function save_obj at 0x000001F536B15A80>
    │    │         └ <module 'sqlalchemy.orm.persistence' from 'C:\\Users\\tomas\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\site-packages\...
    │    └ <module 'sqlalchemy.util.preloaded' from 'C:\\Users\\tomas\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\site-packages\\...
    └ <module 'sqlalchemy.util' from 'C:\\Users\\tomas\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\site-packages\\sqlalchemy...
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\persistence.py", line 85, in save_obj
    _emit_update_statements(
    └ <function _emit_update_statements at 0x000001F536B600E0>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\persistence.py", line 912, in _emit_update_statements
    c = connection.execute(
        │          └ <function Connection.execute at 0x000001F5367E8360>
        └ <sqlalchemy.engine.base.Connection object at 0x000001F53845EE50>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\engine\base.py", line 1418, in execute
    return meth(
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.dml.Update object at 0x000001F5384D2A10>>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\sql\elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x000001F5367E8680>
           └ <sqlalchemy.engine.base.Connection object at 0x000001F53845EE50>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\engine\base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x000001F5367E8860>
          └ <sqlalchemy.engine.base.Connection object at 0x000001F53845EE50>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\engine\base.py", line 1846, in _execute_context
    return self._exec_single_context(
           │    └ <function Connection._exec_single_context at 0x000001F5367E8900>
           └ <sqlalchemy.engine.base.Connection object at 0x000001F53845EE50>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\engine\base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x000001F5367E8B80>
    └ <sqlalchemy.engine.base.Connection object at 0x000001F53845EE50>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\engine\base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
          │                    │              │                 └ NotNullViolation('null value in column "fk_user_id" of relation "user_session" violates not-null constraint\nDETAIL:  Failing...
          │                    │              └ (<class 'psycopg2.errors.NotNullViolation'>, NotNullViolation('null value in column "fk_user_id" of relation "user_session" v...
          │                    └ <method 'with_traceback' of 'BaseException' objects>
          └ IntegrityError('(psycopg2.errors.NotNullViolation) null value in column "fk_user_id" of relation "user_session" violates not-...
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x000001F5368AC360>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x000001F536C74850>
    └ <sqlalchemy.engine.base.Connection object at 0x000001F53845EE50>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\engine\default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'fk_user_id': None, 'user_session_session_id': 15}
    │      │       └ 'UPDATE user_session SET fk_user_id=%(fk_user_id)s WHERE user_session.session_id = %(user_session_session_id)s'
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x000001F53848FBC0; closed: -1>

sqlalchemy.exc.IntegrityError: (psycopg2.errors.NotNullViolation) null value in column "fk_user_id" of relation "user_session" violates not-null constraint
DETAIL:  Failing row contains (15, 2024-11-06 13:16:04.68704+02, 127.0.0.1, null).

[SQL: UPDATE user_session SET fk_user_id=%(fk_user_id)s WHERE user_session.session_id = %(user_session_session_id)s]
[parameters: {'fk_user_id': None, 'user_session_session_id': 15}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2024-11-07 00:46:47.343 | INFO     | app.services.user_service:remove_user:121 - 
REMOVING USER ACCOUNT
2024-11-07 00:46:47.344 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:29 - Validating input
2024-11-07 00:46:47.344 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:60 - Input passed validation
2024-11-07 00:46:47.344 | INFO     | app.validators.user_validator:validate_username:17 - Validating username format
2024-11-07 00:46:47.345 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:29 - Validating input
2024-11-07 00:46:47.345 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:60 - Input passed validation
2024-11-07 00:46:47.345 | INFO     | app.validators.shared_validator:letters_numbers_only:17 - Validating input
2024-11-07 00:46:47.345 | INFO     | app.validators.shared_validator:letters_numbers_only:23 - Input passed validation
2024-11-07 00:46:47.345 | INFO     | app.validators.user_validator:validate_username:31 - Username validation passed
2024-11-07 00:46:47.345 | INFO     | app.validators.user_validator:validate_email:39 - Validating email format
2024-11-07 00:46:47.346 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:29 - Validating input
2024-11-07 00:46:47.346 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:60 - Input passed validation
2024-11-07 00:46:47.346 | INFO     | app.validators.user_validator:validate_email:54 - Email validation passed
2024-11-07 00:46:47.346 | INFO     | app.validators.user_validator:validate_password:62 - Validating password format
2024-11-07 00:46:47.347 | INFO     | app.validators.user_validator:validate_password:89 - Password validation passed
2024-11-07 00:46:47.347 | INFO     | app.crud.user_crud:get_authenticated_user:52 - Searching for user by specified username, email and password_hash
2024-11-07 00:46:47.354 | ERROR    | app.crud.user_crud:get_authenticated_user:64 - Exception with username=First55Select, email=firstUser55@gmail.com: For many-to-one relationship UserSession.user, delete-orphan cascade is normally configured only on the "one" side of a one-to-many relationship, and not on the "many" side of a many-to-one or many-to-many relationship.  To force this relationship to allow a particular "User" object to be referenced by only a single "UserSession" object at a time via the UserSession.user relationship, which would allow delete-orphan cascade to take place in this direction, set the single_parent=True flag. (Background on this error at: https://sqlalche.me/e/20/bbf0)
Traceback (most recent call last):

  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\threading.py", line 1002, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x0000027815BB4860>
    └ <WorkerThread(AnyIO worker thread, started 20464)>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\threading.py", line 1045, in _bootstrap_inner
    self.run()
    │    └ <function WorkerThread.run at 0x000002781B4384A0>
    └ <WorkerThread(AnyIO worker thread, started 20464)>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\anyio\_backends\_asyncio.py", line 914, in run
    result = context.run(func, *args)
             │       │   │      └ ()
             │       │   └ functools.partial(<function delete_user at 0x000002781B392660>, db=<sqlalchemy.orm.session.Session object at 0x000002781B3CB8...
             │       └ <method 'run' of '_contextvars.Context' objects>
             └ <_contextvars.Context object at 0x000002781B446E80>

  File "C:\Users\tomas\Documents\Saityno Progr. Projektavimas\StreamaBit\app\main.py", line 61, in delete_user
    return user_services.remove_user(db=db, username=username, data=data)
           │             │              │            │              └ UserDelete(email='firstUser55@gmail.com', password='Password1234$')
           │             │              │            └ 'First55Select'
           │             │              └ <sqlalchemy.orm.session.Session object at 0x000002781B3CB890>
           │             └ <function remove_user at 0x000002781B01EC00>
           └ <module 'app.services.user_service' from 'C:\\Users\\tomas\\Documents\\Saityno Progr. Projektavimas\\StreamaBit\\app\\service...

  File "C:\Users\tomas\Documents\Saityno Progr. Projektavimas\StreamaBit\app\services\user_service.py", line 128, in remove_user
    db_user = user_crud.get_authenticated_user(db=db, username=username, email=data.email, password_hash=data.password)
              │         │                         │            │               │    │                    │    └ 'Password1234$'
              │         │                         │            │               │    │                    └ UserDelete(email='firstUser55@gmail.com', password='Password1234$')
              │         │                         │            │               │    └ 'firstUser55@gmail.com'
              │         │                         │            │               └ UserDelete(email='firstUser55@gmail.com', password='Password1234$')
              │         │                         │            └ 'First55Select'
              │         │                         └ <sqlalchemy.orm.session.Session object at 0x000002781B3CB890>
              │         └ <function get_authenticated_user at 0x000002781B01E660>
              └ <module 'app.crud.user_crud' from 'C:\\Users\\tomas\\Documents\\Saityno Progr. Projektavimas\\StreamaBit\\app\\crud\\user_cru...

> File "C:\Users\tomas\Documents\Saityno Progr. Projektavimas\StreamaBit\app\crud\user_crud.py", line 53, in get_authenticated_user
    query = db.query(models.User)
            │  │     │      └ <class 'app.models.database.User'>
            │  │     └ <module 'app.models.database' from 'C:\\Users\\tomas\\Documents\\Saityno Progr. Projektavimas\\StreamaBit\\app\\models\\datab...
            │  └ <function Session.query at 0x0000027819C3B2E0>
            └ <sqlalchemy.orm.session.Session object at 0x000002781B3CB890>

  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\session.py", line 2952, in query
    return self._query_cls(entities, self, **kwargs)
           │    │          │         │       └ {}
           │    │          │         └ <sqlalchemy.orm.session.Session object at 0x000002781B3CB890>
           │    │          └ (<class 'app.models.database.User'>,)
           │    └ <class 'sqlalchemy.orm.query.Query'>
           └ <sqlalchemy.orm.session.Session object at 0x000002781B3CB890>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\query.py", line 275, in __init__
    self._set_entities(entities)
    │    │             └ (<class 'app.models.database.User'>,)
    │    └ <function Query._set_entities at 0x0000027819B74F40>
    └ <sqlalchemy.orm.query.Query object at 0x000002781B3E7BD0>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\query.py", line 287, in _set_entities
    self._raw_columns = [
    └ <sqlalchemy.orm.query.Query object at 0x000002781B3E7BD0>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\query.py", line 288, in <listcomp>
    coercions.expect(
    │         └ <function expect at 0x00000278195BC220>
    └ <module 'sqlalchemy.sql.coercions' from 'C:\\Users\\tomas\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\site-packages\\s...
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\sql\coercions.py", line 389, in expect
    insp._post_inspect
    │    └ <sqlalchemy.util.langhelpers.HasMemoized.memoized_attribute object at 0x0000027819B6D550>
    └ <Mapper at 0x27819f21590; User>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 1253, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
    │   │        │    │                    │    │    └ <Mapper at 0x27819f21590; User>
    │   │        │    │                    │    └ <function Mapper._post_inspect at 0x0000027819B711C0>
    │   │        │    │                    └ <sqlalchemy.util.langhelpers.HasMemoized.memoized_attribute object at 0x0000027819B6D550>
    │   │        │    └ '_post_inspect'
    │   │        └ <sqlalchemy.util.langhelpers.HasMemoized.memoized_attribute object at 0x0000027819B6D550>
    │   └ <attribute '__dict__' of 'Mapper' objects>
    └ <Mapper at 0x27819f21590; User>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2711, in _post_inspect
    self._check_configure()
    │    └ <function Mapper._check_configure at 0x0000027819B70400>
    └ <Mapper at 0x27819f21590; User>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2388, in _check_configure
    _configure_registries({self.registry}, cascade=True)
    │                      │    └ <sqlalchemy.orm.decl_api.registry object at 0x0000027819E84F10>
    │                      └ <Mapper at 0x27819f21590; User>
    └ <function _configure_registries at 0x0000027819B740E0>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4204, in _configure_registries
    _do_configure_registries(registries, cascade)
    │                        │           └ True
    │                        └ set()
    └ <function _do_configure_registries at 0x0000027819B74220>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4245, in _do_configure_registries
    mapper._post_configure_properties()
    │      └ <function Mapper._post_configure_properties at 0x0000027819B702C0>
    └ <Mapper at 0x27819f4cf50; UserSession>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2405, in _post_configure_properties
    prop.init()
    │    └ <function MapperProperty.init at 0x0000027819A30C20>
    └ <_RelationshipDeclared at 0x27819f42490; user>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\interfaces.py", line 584, in init
    self.do_init()
    │    └ <function RelationshipProperty.do_init at 0x0000027819B42B60>
    └ <_RelationshipDeclared at 0x27819f42490; user>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\relationships.py", line 1645, in do_init
    self._check_cascade_settings(self._cascade)
    │    │                       │    └ CascadeOptions('delete,delete-orphan,expunge,merge,refresh-expire,save-update')
    │    │                       └ <_RelationshipDeclared at 0x27819f42490; user>
    │    └ <function RelationshipProperty._check_cascade_settings at 0x0000027819B43380>
    └ <_RelationshipDeclared at 0x27819f42490; user>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\relationships.py", line 1988, in _check_cascade_settings
    raise sa_exc.ArgumentError(
          │      └ <class 'sqlalchemy.exc.ArgumentError'>
          └ <module 'sqlalchemy.exc' from 'C:\\Users\\tomas\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\site-packages\\sqlalchemy\...

sqlalchemy.exc.ArgumentError: For many-to-one relationship UserSession.user, delete-orphan cascade is normally configured only on the "one" side of a one-to-many relationship, and not on the "many" side of a many-to-one or many-to-many relationship.  To force this relationship to allow a particular "User" object to be referenced by only a single "UserSession" object at a time via the UserSession.user relationship, which would allow delete-orphan cascade to take place in this direction, set the single_parent=True flag. (Background on this error at: https://sqlalche.me/e/20/bbf0)
2024-11-07 00:46:47.371 | ERROR    | app.services.user_service:remove_user:142 - 
USER ACCOUNT HAS NOT BEEN REMOVED, EXCEPTION OCCURED: 500: An unexpected error occurred
Traceback (most recent call last):

  File "C:\Users\tomas\Documents\Saityno Progr. Projektavimas\StreamaBit\app\crud\user_crud.py", line 53, in get_authenticated_user
    query = db.query(models.User)
            │  │     │      └ <class 'app.models.database.User'>
            │  │     └ <module 'app.models.database' from 'C:\\Users\\tomas\\Documents\\Saityno Progr. Projektavimas\\StreamaBit\\app\\models\\datab...
            │  └ <function Session.query at 0x0000027819C3B2E0>
            └ <sqlalchemy.orm.session.Session object at 0x000002781B3CB890>

  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\session.py", line 2952, in query
    return self._query_cls(entities, self, **kwargs)
           │    │          │         │       └ {}
           │    │          │         └ <sqlalchemy.orm.session.Session object at 0x000002781B3CB890>
           │    │          └ (<class 'app.models.database.User'>,)
           │    └ <class 'sqlalchemy.orm.query.Query'>
           └ <sqlalchemy.orm.session.Session object at 0x000002781B3CB890>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\query.py", line 275, in __init__
    self._set_entities(entities)
    │    │             └ (<class 'app.models.database.User'>,)
    │    └ <function Query._set_entities at 0x0000027819B74F40>
    └ <sqlalchemy.orm.query.Query object at 0x000002781B3E7BD0>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\query.py", line 287, in _set_entities
    self._raw_columns = [
    └ <sqlalchemy.orm.query.Query object at 0x000002781B3E7BD0>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\query.py", line 288, in <listcomp>
    coercions.expect(
    │         └ <function expect at 0x00000278195BC220>
    └ <module 'sqlalchemy.sql.coercions' from 'C:\\Users\\tomas\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\site-packages\\s...
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\sql\coercions.py", line 389, in expect
    insp._post_inspect
    │    └ <sqlalchemy.util.langhelpers.HasMemoized.memoized_attribute object at 0x0000027819B6D550>
    └ <Mapper at 0x27819f21590; User>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 1253, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
    │   │        │    │                    │    │    └ <Mapper at 0x27819f21590; User>
    │   │        │    │                    │    └ <function Mapper._post_inspect at 0x0000027819B711C0>
    │   │        │    │                    └ <sqlalchemy.util.langhelpers.HasMemoized.memoized_attribute object at 0x0000027819B6D550>
    │   │        │    └ '_post_inspect'
    │   │        └ <sqlalchemy.util.langhelpers.HasMemoized.memoized_attribute object at 0x0000027819B6D550>
    │   └ <attribute '__dict__' of 'Mapper' objects>
    └ <Mapper at 0x27819f21590; User>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2711, in _post_inspect
    self._check_configure()
    │    └ <function Mapper._check_configure at 0x0000027819B70400>
    └ <Mapper at 0x27819f21590; User>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2388, in _check_configure
    _configure_registries({self.registry}, cascade=True)
    │                      │    └ <sqlalchemy.orm.decl_api.registry object at 0x0000027819E84F10>
    │                      └ <Mapper at 0x27819f21590; User>
    └ <function _configure_registries at 0x0000027819B740E0>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4204, in _configure_registries
    _do_configure_registries(registries, cascade)
    │                        │           └ True
    │                        └ set()
    └ <function _do_configure_registries at 0x0000027819B74220>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4245, in _do_configure_registries
    mapper._post_configure_properties()
    │      └ <function Mapper._post_configure_properties at 0x0000027819B702C0>
    └ <Mapper at 0x27819f4cf50; UserSession>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2405, in _post_configure_properties
    prop.init()
    │    └ <function MapperProperty.init at 0x0000027819A30C20>
    └ <_RelationshipDeclared at 0x27819f42490; user>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\interfaces.py", line 584, in init
    self.do_init()
    │    └ <function RelationshipProperty.do_init at 0x0000027819B42B60>
    └ <_RelationshipDeclared at 0x27819f42490; user>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\relationships.py", line 1645, in do_init
    self._check_cascade_settings(self._cascade)
    │    │                       │    └ CascadeOptions('delete,delete-orphan,expunge,merge,refresh-expire,save-update')
    │    │                       └ <_RelationshipDeclared at 0x27819f42490; user>
    │    └ <function RelationshipProperty._check_cascade_settings at 0x0000027819B43380>
    └ <_RelationshipDeclared at 0x27819f42490; user>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\relationships.py", line 1988, in _check_cascade_settings
    raise sa_exc.ArgumentError(
          │      └ <class 'sqlalchemy.exc.ArgumentError'>
          └ <module 'sqlalchemy.exc' from 'C:\\Users\\tomas\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\site-packages\\sqlalchemy\...

sqlalchemy.exc.ArgumentError: For many-to-one relationship UserSession.user, delete-orphan cascade is normally configured only on the "one" side of a one-to-many relationship, and not on the "many" side of a many-to-one or many-to-many relationship.  To force this relationship to allow a particular "User" object to be referenced by only a single "UserSession" object at a time via the UserSession.user relationship, which would allow delete-orphan cascade to take place in this direction, set the single_parent=True flag. (Background on this error at: https://sqlalche.me/e/20/bbf0)


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\threading.py", line 1002, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x0000027815BB4860>
    └ <WorkerThread(AnyIO worker thread, started 20464)>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\threading.py", line 1045, in _bootstrap_inner
    self.run()
    │    └ <function WorkerThread.run at 0x000002781B4384A0>
    └ <WorkerThread(AnyIO worker thread, started 20464)>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\anyio\_backends\_asyncio.py", line 914, in run
    result = context.run(func, *args)
             │       │   │      └ ()
             │       │   └ functools.partial(<function delete_user at 0x000002781B392660>, db=<sqlalchemy.orm.session.Session object at 0x000002781B3CB8...
             │       └ <method 'run' of '_contextvars.Context' objects>
             └ <_contextvars.Context object at 0x000002781B446E80>

  File "C:\Users\tomas\Documents\Saityno Progr. Projektavimas\StreamaBit\app\main.py", line 61, in delete_user
    return user_services.remove_user(db=db, username=username, data=data)
           │             │              │            │              └ UserDelete(email='firstUser55@gmail.com', password='Password1234$')
           │             │              │            └ 'First55Select'
           │             │              └ <sqlalchemy.orm.session.Session object at 0x000002781B3CB890>
           │             └ <function remove_user at 0x000002781B01EC00>
           └ <module 'app.services.user_service' from 'C:\\Users\\tomas\\Documents\\Saityno Progr. Projektavimas\\StreamaBit\\app\\service...

> File "C:\Users\tomas\Documents\Saityno Progr. Projektavimas\StreamaBit\app\services\user_service.py", line 128, in remove_user
    db_user = user_crud.get_authenticated_user(db=db, username=username, email=data.email, password_hash=data.password)
              │         │                         │            │               │    │                    │    └ 'Password1234$'
              │         │                         │            │               │    │                    └ UserDelete(email='firstUser55@gmail.com', password='Password1234$')
              │         │                         │            │               │    └ 'firstUser55@gmail.com'
              │         │                         │            │               └ UserDelete(email='firstUser55@gmail.com', password='Password1234$')
              │         │                         │            └ 'First55Select'
              │         │                         └ <sqlalchemy.orm.session.Session object at 0x000002781B3CB890>
              │         └ <function get_authenticated_user at 0x000002781B01E660>
              └ <module 'app.crud.user_crud' from 'C:\\Users\\tomas\\Documents\\Saityno Progr. Projektavimas\\StreamaBit\\app\\crud\\user_cru...

  File "C:\Users\tomas\Documents\Saityno Progr. Projektavimas\StreamaBit\app\crud\user_crud.py", line 65, in get_authenticated_user
    raise HTTPException(status_code=500, detail="An unexpected error occurred")
          └ <class 'fastapi.exceptions.HTTPException'>

fastapi.exceptions.HTTPException: 500: An unexpected error occurred
2024-11-07 00:47:33.068 | INFO     | app.services.user_service:remove_user:121 - 
REMOVING USER ACCOUNT
2024-11-07 00:47:33.069 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:29 - Validating input
2024-11-07 00:47:33.070 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:60 - Input passed validation
2024-11-07 00:47:33.070 | INFO     | app.validators.user_validator:validate_username:17 - Validating username format
2024-11-07 00:47:33.070 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:29 - Validating input
2024-11-07 00:47:33.070 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:60 - Input passed validation
2024-11-07 00:47:33.070 | INFO     | app.validators.shared_validator:letters_numbers_only:17 - Validating input
2024-11-07 00:47:33.071 | INFO     | app.validators.shared_validator:letters_numbers_only:23 - Input passed validation
2024-11-07 00:47:33.071 | INFO     | app.validators.user_validator:validate_username:31 - Username validation passed
2024-11-07 00:47:33.071 | INFO     | app.validators.user_validator:validate_email:39 - Validating email format
2024-11-07 00:47:33.071 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:29 - Validating input
2024-11-07 00:47:33.071 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:60 - Input passed validation
2024-11-07 00:47:33.071 | INFO     | app.validators.user_validator:validate_email:54 - Email validation passed
2024-11-07 00:47:33.072 | INFO     | app.validators.user_validator:validate_password:62 - Validating password format
2024-11-07 00:47:33.072 | INFO     | app.validators.user_validator:validate_password:89 - Password validation passed
2024-11-07 00:47:33.072 | INFO     | app.crud.user_crud:get_authenticated_user:52 - Searching for user by specified username, email and password_hash
2024-11-07 00:47:33.093 | INFO     | app.crud.user_crud:get_authenticated_user:56 - User found
2024-11-07 00:47:33.098 | INFO     | app.crud.user_crud:delete:131 - Attempting to remove user account
2024-11-07 00:47:33.101 | INFO     | app.crud.user_crud:delete:139 - User prepared for account removal, waiting for transaction commit
2024-11-07 00:47:33.120 | INFO     | app.services.user_service:remove_user:139 - 
USER ACCOUNT REMOVED
2024-11-07 00:49:37.245 | INFO     | app.services.user_service:remove_user:121 - 
REMOVING USER ACCOUNT
2024-11-07 00:49:37.246 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:29 - Validating input
2024-11-07 00:49:37.247 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:60 - Input passed validation
2024-11-07 00:49:37.247 | INFO     | app.validators.user_validator:validate_username:17 - Validating username format
2024-11-07 00:49:37.247 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:29 - Validating input
2024-11-07 00:49:37.248 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:60 - Input passed validation
2024-11-07 00:49:37.248 | INFO     | app.validators.shared_validator:letters_numbers_only:17 - Validating input
2024-11-07 00:49:37.248 | INFO     | app.validators.shared_validator:letters_numbers_only:23 - Input passed validation
2024-11-07 00:49:37.248 | INFO     | app.validators.user_validator:validate_username:31 - Username validation passed
2024-11-07 00:49:37.249 | INFO     | app.validators.user_validator:validate_email:39 - Validating email format
2024-11-07 00:49:37.249 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:29 - Validating input
2024-11-07 00:49:37.249 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:60 - Input passed validation
2024-11-07 00:49:37.249 | INFO     | app.validators.user_validator:validate_email:54 - Email validation passed
2024-11-07 00:49:37.249 | INFO     | app.validators.user_validator:validate_password:62 - Validating password format
2024-11-07 00:49:37.250 | INFO     | app.validators.user_validator:validate_password:89 - Password validation passed
2024-11-07 00:49:37.250 | INFO     | app.crud.user_crud:get_authenticated_user:52 - Searching for user by specified username, email and password_hash
2024-11-07 00:49:37.273 | INFO     | app.crud.user_crud:get_authenticated_user:56 - User found
2024-11-07 00:49:37.281 | WARNING  | app.services.user_service:remove_user:133 - CANNOT REMOVE USER ACCOUNT - USER WITH PROVIDED CREDENTIALS NOT FOUND
2024-11-07 00:49:37.281 | ERROR    | app.services.user_service:remove_user:142 - 
USER ACCOUNT HAS NOT BEEN REMOVED, EXCEPTION OCCURED: 404: User not found
Traceback (most recent call last):

  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\threading.py", line 1002, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x000001EEC8984860>
    └ <WorkerThread(AnyIO worker thread, started 19132)>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\threading.py", line 1045, in _bootstrap_inner
    self.run()
    │    └ <function WorkerThread.run at 0x000001EECE1DC4A0>
    └ <WorkerThread(AnyIO worker thread, started 19132)>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\anyio\_backends\_asyncio.py", line 914, in run
    result = context.run(func, *args)
             │       │   │      └ ()
             │       │   └ functools.partial(<function delete_user at 0x000001EECE132660>, db=<sqlalchemy.orm.session.Session object at 0x000001EECE187D...
             │       └ <method 'run' of '_contextvars.Context' objects>
             └ <_contextvars.Context object at 0x000001EECE137D40>

  File "C:\Users\tomas\Documents\Saityno Progr. Projektavimas\StreamaBit\app\main.py", line 61, in delete_user
    return user_services.remove_user(db=db, username=username, data=data)
           │             │              │            │              └ UserDelete(email='firstUser56@gmail.com', password='Password1234s$')
           │             │              │            └ 'First56'
           │             │              └ <sqlalchemy.orm.session.Session object at 0x000001EECE187D90>
           │             └ <function remove_user at 0x000001EECDDBEC00>
           └ <module 'app.services.user_service' from 'C:\\Users\\tomas\\Documents\\Saityno Progr. Projektavimas\\StreamaBit\\app\\service...

> File "C:\Users\tomas\Documents\Saityno Progr. Projektavimas\StreamaBit\app\services\user_service.py", line 134, in remove_user
    raise HTTPException(status_code=404, detail="User not found")
          └ <class 'fastapi.exceptions.HTTPException'>

fastapi.exceptions.HTTPException: 404: User not found
2024-11-07 00:49:46.171 | INFO     | app.services.user_service:remove_user:121 - 
REMOVING USER ACCOUNT
2024-11-07 00:49:46.172 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:29 - Validating input
2024-11-07 00:49:46.172 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:60 - Input passed validation
2024-11-07 00:49:46.172 | INFO     | app.validators.user_validator:validate_username:17 - Validating username format
2024-11-07 00:49:46.172 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:29 - Validating input
2024-11-07 00:49:46.173 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:60 - Input passed validation
2024-11-07 00:49:46.173 | INFO     | app.validators.shared_validator:letters_numbers_only:17 - Validating input
2024-11-07 00:49:46.173 | INFO     | app.validators.shared_validator:letters_numbers_only:23 - Input passed validation
2024-11-07 00:49:46.173 | INFO     | app.validators.user_validator:validate_username:31 - Username validation passed
2024-11-07 00:49:46.173 | INFO     | app.validators.user_validator:validate_email:39 - Validating email format
2024-11-07 00:49:46.173 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:29 - Validating input
2024-11-07 00:49:46.173 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:60 - Input passed validation
2024-11-07 00:49:46.174 | WARNING  | app.validators.user_validator:validate_email:51 - Provided email is invalid: firstUser56@gmail.com,
2024-11-07 00:49:46.174 | ERROR    | app.services.user_service:remove_user:142 - 
USER ACCOUNT HAS NOT BEEN REMOVED, EXCEPTION OCCURED: Invalid email format
Traceback (most recent call last):

  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\threading.py", line 1002, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x000001EEC8984860>
    └ <WorkerThread(AnyIO worker thread, started 19132)>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\threading.py", line 1045, in _bootstrap_inner
    self.run()
    │    └ <function WorkerThread.run at 0x000001EECE1DC4A0>
    └ <WorkerThread(AnyIO worker thread, started 19132)>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\anyio\_backends\_asyncio.py", line 914, in run
    result = context.run(func, *args)
             │       │   │      └ ()
             │       │   └ functools.partial(<function delete_user at 0x000001EECE132660>, db=<sqlalchemy.orm.session.Session object at 0x000001EECE1799...
             │       └ <method 'run' of '_contextvars.Context' objects>
             └ <_contextvars.Context object at 0x000001EECE187C80>

  File "C:\Users\tomas\Documents\Saityno Progr. Projektavimas\StreamaBit\app\main.py", line 61, in delete_user
    return user_services.remove_user(db=db, username=username, data=data)
           │             │              │            │              └ UserDelete(email='firstUser56@gmail.com,', password='Password1234$')
           │             │              │            └ 'First56'
           │             │              └ <sqlalchemy.orm.session.Session object at 0x000001EECE179950>
           │             └ <function remove_user at 0x000001EECDDBEC00>
           └ <module 'app.services.user_service' from 'C:\\Users\\tomas\\Documents\\Saityno Progr. Projektavimas\\StreamaBit\\app\\service...

> File "C:\Users\tomas\Documents\Saityno Progr. Projektavimas\StreamaBit\app\services\user_service.py", line 124, in remove_user
    user_validator.validate_email(data.email)
    │              │              │    └ 'firstUser56@gmail.com,'
    │              │              └ UserDelete(email='firstUser56@gmail.com,', password='Password1234$')
    │              └ <function validate_email at 0x000001EECDDBE160>
    └ <module 'app.validators.user_validator' from 'C:\\Users\\tomas\\Documents\\Saityno Progr. Projektavimas\\StreamaBit\\app\\val...

  File "C:\Users\tomas\Documents\Saityno Progr. Projektavimas\StreamaBit\app\validators\user_validator.py", line 52, in validate_email
    raise shared_validator.ValidationException("Invalid email format")
          │                └ <class 'app.validators.shared_validator.ValidationException'>
          └ <module 'app.validators.shared_validator' from 'C:\\Users\\tomas\\Documents\\Saityno Progr. Projektavimas\\StreamaBit\\app\\v...

app.validators.shared_validator.ValidationException: Invalid email format
2024-11-07 00:49:50.692 | INFO     | app.services.user_service:remove_user:121 - 
REMOVING USER ACCOUNT
2024-11-07 00:49:50.692 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:29 - Validating input
2024-11-07 00:49:50.692 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:60 - Input passed validation
2024-11-07 00:49:50.693 | INFO     | app.validators.user_validator:validate_username:17 - Validating username format
2024-11-07 00:49:50.693 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:29 - Validating input
2024-11-07 00:49:50.693 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:60 - Input passed validation
2024-11-07 00:49:50.693 | INFO     | app.validators.shared_validator:letters_numbers_only:17 - Validating input
2024-11-07 00:49:50.693 | INFO     | app.validators.shared_validator:letters_numbers_only:23 - Input passed validation
2024-11-07 00:49:50.693 | INFO     | app.validators.user_validator:validate_username:31 - Username validation passed
2024-11-07 00:49:50.694 | INFO     | app.validators.user_validator:validate_email:39 - Validating email format
2024-11-07 00:49:50.694 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:29 - Validating input
2024-11-07 00:49:50.694 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:60 - Input passed validation
2024-11-07 00:49:50.694 | INFO     | app.validators.user_validator:validate_email:54 - Email validation passed
2024-11-07 00:49:50.694 | INFO     | app.validators.user_validator:validate_password:62 - Validating password format
2024-11-07 00:49:50.694 | INFO     | app.validators.user_validator:validate_password:89 - Password validation passed
2024-11-07 00:49:50.694 | INFO     | app.crud.user_crud:get_authenticated_user:52 - Searching for user by specified username, email and password_hash
2024-11-07 00:49:50.695 | INFO     | app.crud.user_crud:get_authenticated_user:56 - User found
2024-11-07 00:49:50.696 | WARNING  | app.services.user_service:remove_user:133 - CANNOT REMOVE USER ACCOUNT - USER WITH PROVIDED CREDENTIALS NOT FOUND
2024-11-07 00:49:50.696 | ERROR    | app.services.user_service:remove_user:142 - 
USER ACCOUNT HAS NOT BEEN REMOVED, EXCEPTION OCCURED: 404: User not found
Traceback (most recent call last):

  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\threading.py", line 1002, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x000001EEC8984860>
    └ <WorkerThread(AnyIO worker thread, started 19132)>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\threading.py", line 1045, in _bootstrap_inner
    self.run()
    │    └ <function WorkerThread.run at 0x000001EECE1DC4A0>
    └ <WorkerThread(AnyIO worker thread, started 19132)>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\anyio\_backends\_asyncio.py", line 914, in run
    result = context.run(func, *args)
             │       │   │      └ ()
             │       │   └ functools.partial(<function delete_user at 0x000001EECE132660>, db=<sqlalchemy.orm.session.Session object at 0x000001EECE33E0...
             │       └ <method 'run' of '_contextvars.Context' objects>
             └ <_contextvars.Context object at 0x000001EECE339280>

  File "C:\Users\tomas\Documents\Saityno Progr. Projektavimas\StreamaBit\app\main.py", line 61, in delete_user
    return user_services.remove_user(db=db, username=username, data=data)
           │             │              │            │              └ UserDelete(email='firstUser56@gmail.comm', password='Password1234$')
           │             │              │            └ 'First56'
           │             │              └ <sqlalchemy.orm.session.Session object at 0x000001EECE33E010>
           │             └ <function remove_user at 0x000001EECDDBEC00>
           └ <module 'app.services.user_service' from 'C:\\Users\\tomas\\Documents\\Saityno Progr. Projektavimas\\StreamaBit\\app\\service...

> File "C:\Users\tomas\Documents\Saityno Progr. Projektavimas\StreamaBit\app\services\user_service.py", line 134, in remove_user
    raise HTTPException(status_code=404, detail="User not found")
          └ <class 'fastapi.exceptions.HTTPException'>

fastapi.exceptions.HTTPException: 404: User not found
2024-11-07 00:49:54.848 | INFO     | app.services.user_service:remove_user:121 - 
REMOVING USER ACCOUNT
2024-11-07 00:49:54.848 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:29 - Validating input
2024-11-07 00:49:54.849 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:60 - Input passed validation
2024-11-07 00:49:54.849 | INFO     | app.validators.user_validator:validate_username:17 - Validating username format
2024-11-07 00:49:54.849 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:29 - Validating input
2024-11-07 00:49:54.849 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:60 - Input passed validation
2024-11-07 00:49:54.849 | INFO     | app.validators.shared_validator:letters_numbers_only:17 - Validating input
2024-11-07 00:49:54.850 | INFO     | app.validators.shared_validator:letters_numbers_only:23 - Input passed validation
2024-11-07 00:49:54.850 | INFO     | app.validators.user_validator:validate_username:31 - Username validation passed
2024-11-07 00:49:54.850 | INFO     | app.validators.user_validator:validate_email:39 - Validating email format
2024-11-07 00:49:54.850 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:29 - Validating input
2024-11-07 00:49:54.850 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:60 - Input passed validation
2024-11-07 00:49:54.851 | INFO     | app.validators.user_validator:validate_email:54 - Email validation passed
2024-11-07 00:49:54.851 | INFO     | app.validators.user_validator:validate_password:62 - Validating password format
2024-11-07 00:49:54.851 | INFO     | app.validators.user_validator:validate_password:89 - Password validation passed
2024-11-07 00:49:54.851 | INFO     | app.crud.user_crud:get_authenticated_user:52 - Searching for user by specified username, email and password_hash
2024-11-07 00:49:54.851 | INFO     | app.crud.user_crud:get_authenticated_user:56 - User found
2024-11-07 00:49:54.852 | WARNING  | app.services.user_service:remove_user:133 - CANNOT REMOVE USER ACCOUNT - USER WITH PROVIDED CREDENTIALS NOT FOUND
2024-11-07 00:49:54.853 | ERROR    | app.services.user_service:remove_user:142 - 
USER ACCOUNT HAS NOT BEEN REMOVED, EXCEPTION OCCURED: 404: User not found
Traceback (most recent call last):

  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\threading.py", line 1002, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x000001EEC8984860>
    └ <WorkerThread(AnyIO worker thread, started 19132)>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\threading.py", line 1045, in _bootstrap_inner
    self.run()
    │    └ <function WorkerThread.run at 0x000001EECE1DC4A0>
    └ <WorkerThread(AnyIO worker thread, started 19132)>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\anyio\_backends\_asyncio.py", line 914, in run
    result = context.run(func, *args)
             │       │   │      └ ()
             │       │   └ functools.partial(<function delete_user at 0x000001EECE132660>, db=<sqlalchemy.orm.session.Session object at 0x000001EECE2BE7...
             │       └ <method 'run' of '_contextvars.Context' objects>
             └ <_contextvars.Context object at 0x000001EECE3450C0>

  File "C:\Users\tomas\Documents\Saityno Progr. Projektavimas\StreamaBit\app\main.py", line 61, in delete_user
    return user_services.remove_user(db=db, username=username, data=data)
           │             │              │            │              └ UserDelete(email='firstUser56@gmail.com', password='Password1234$')
           │             │              │            └ 'First56s'
           │             │              └ <sqlalchemy.orm.session.Session object at 0x000001EECE2BE7D0>
           │             └ <function remove_user at 0x000001EECDDBEC00>
           └ <module 'app.services.user_service' from 'C:\\Users\\tomas\\Documents\\Saityno Progr. Projektavimas\\StreamaBit\\app\\service...

> File "C:\Users\tomas\Documents\Saityno Progr. Projektavimas\StreamaBit\app\services\user_service.py", line 134, in remove_user
    raise HTTPException(status_code=404, detail="User not found")
          └ <class 'fastapi.exceptions.HTTPException'>

fastapi.exceptions.HTTPException: 404: User not found
2024-11-07 00:50:14.644 | INFO     | app.services.user_service:remove_user:121 - 
REMOVING USER ACCOUNT
2024-11-07 00:50:14.644 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:29 - Validating input
2024-11-07 00:50:14.644 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:60 - Input passed validation
2024-11-07 00:50:14.644 | INFO     | app.validators.user_validator:validate_username:17 - Validating username format
2024-11-07 00:50:14.645 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:29 - Validating input
2024-11-07 00:50:14.645 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:60 - Input passed validation
2024-11-07 00:50:14.645 | INFO     | app.validators.shared_validator:letters_numbers_only:17 - Validating input
2024-11-07 00:50:14.645 | INFO     | app.validators.shared_validator:letters_numbers_only:23 - Input passed validation
2024-11-07 00:50:14.645 | INFO     | app.validators.user_validator:validate_username:31 - Username validation passed
2024-11-07 00:50:14.645 | INFO     | app.validators.user_validator:validate_email:39 - Validating email format
2024-11-07 00:50:14.645 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:29 - Validating input
2024-11-07 00:50:14.646 | INFO     | app.validators.shared_validator:validate_sql_malicious_input:60 - Input passed validation
2024-11-07 00:50:14.646 | INFO     | app.validators.user_validator:validate_email:54 - Email validation passed
2024-11-07 00:50:14.646 | INFO     | app.validators.user_validator:validate_password:62 - Validating password format
2024-11-07 00:50:14.646 | INFO     | app.validators.user_validator:validate_password:89 - Password validation passed
2024-11-07 00:50:14.646 | INFO     | app.crud.user_crud:get_authenticated_user:52 - Searching for user by specified username, email and password_hash
2024-11-07 00:50:14.647 | INFO     | app.crud.user_crud:get_authenticated_user:56 - User found
2024-11-07 00:50:14.648 | INFO     | app.crud.user_crud:delete:131 - Attempting to remove user account
2024-11-07 00:50:14.651 | INFO     | app.crud.user_crud:delete:139 - User prepared for account removal, waiting for transaction commit
2024-11-07 00:50:14.667 | INFO     | app.services.user_service:remove_user:139 - 
USER ACCOUNT REMOVED
