2024-11-07 00:00:38.012 | ERROR    | app.services.user_service:remove_user:142 - 
USER ACCOUNT HAS NOT BEEN REMOVED, EXCEPTION OCCURED: 404: User not found
Traceback (most recent call last):

  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\threading.py", line 1002, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x000001EB30EB4860>
    └ <WorkerThread(AnyIO worker thread, started 7752)>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\threading.py", line 1045, in _bootstrap_inner
    self.run()
    │    └ <function WorkerThread.run at 0x000001EB36368400>
    └ <WorkerThread(AnyIO worker thread, started 7752)>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\anyio\_backends\_asyncio.py", line 914, in run
    result = context.run(func, *args)
             │       │   │      └ ()
             │       │   └ functools.partial(<function delete_user at 0x000001EB362C2660>, db=<sqlalchemy.orm.session.Session object at 0x000001EB362C6B...
             │       └ <method 'run' of '_contextvars.Context' objects>
             └ <_contextvars.Context object at 0x000001EB351BA000>

  File "C:\Users\tomas\Documents\Saityno Progr. Projektavimas\StreamaBit\app\main.py", line 61, in delete_user
    return user_services.remove_user(db=db, username=username, data=data)
           │             │              │            │              └ UserDelete(email='firstUser55@gmail.com', password='Password1234s$')
           │             │              │            └ 'First55Select'
           │             │              └ <sqlalchemy.orm.session.Session object at 0x000001EB362C6B90>
           │             └ <function remove_user at 0x000001EB352BEC00>
           └ <module 'app.services.user_service' from 'C:\\Users\\tomas\\Documents\\Saityno Progr. Projektavimas\\StreamaBit\\app\\service...

> File "C:\Users\tomas\Documents\Saityno Progr. Projektavimas\StreamaBit\app\services\user_service.py", line 134, in remove_user
    raise HTTPException(status_code=404, detail="User not found")
          └ <class 'fastapi.exceptions.HTTPException'>

fastapi.exceptions.HTTPException: 404: User not found
2024-11-07 00:00:43.427 | ERROR    | app.services.user_service:remove_user:142 - 
USER ACCOUNT HAS NOT BEEN REMOVED, EXCEPTION OCCURED: (psycopg2.errors.NotNullViolation) null value in column "fk_user_id" of relation "user_session" violates not-null constraint
DETAIL:  Failing row contains (15, 2024-11-06 13:16:04.68704+02, 127.0.0.1, null).

[SQL: UPDATE user_session SET fk_user_id=%(fk_user_id)s WHERE user_session.session_id = %(user_session_session_id)s]
[parameters: {'fk_user_id': None, 'user_session_session_id': 15}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):

  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x000001EB34BDC360>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x000001EB34FA44D0>
    └ <sqlalchemy.engine.base.Connection object at 0x000001EB36807910>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\engine\default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'fk_user_id': None, 'user_session_session_id': 15}
    │      │       └ 'UPDATE user_session SET fk_user_id=%(fk_user_id)s WHERE user_session.session_id = %(user_session_session_id)s'
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x000001EB368589E0; closed: -1>

psycopg2.errors.NotNullViolation: null value in column "fk_user_id" of relation "user_session" violates not-null constraint
DETAIL:  Failing row contains (15, 2024-11-06 13:16:04.68704+02, 127.0.0.1, null).



The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\threading.py", line 1002, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x000001EB30EB4860>
    └ <WorkerThread(AnyIO worker thread, started 7752)>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\threading.py", line 1045, in _bootstrap_inner
    self.run()
    │    └ <function WorkerThread.run at 0x000001EB36368400>
    └ <WorkerThread(AnyIO worker thread, started 7752)>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\anyio\_backends\_asyncio.py", line 914, in run
    result = context.run(func, *args)
             │       │   │      └ ()
             │       │   └ functools.partial(<function delete_user at 0x000001EB362C2660>, db=<sqlalchemy.orm.session.Session object at 0x000001EB33AA17...
             │       └ <method 'run' of '_contextvars.Context' objects>
             └ <_contextvars.Context object at 0x000001EB36300180>

  File "C:\Users\tomas\Documents\Saityno Progr. Projektavimas\StreamaBit\app\main.py", line 61, in delete_user
    return user_services.remove_user(db=db, username=username, data=data)
           │             │              │            │              └ UserDelete(email='firstUser55@gmail.com', password='Password1234$')
           │             │              │            └ 'First55Select'
           │             │              └ <sqlalchemy.orm.session.Session object at 0x000001EB33AA1710>
           │             └ <function remove_user at 0x000001EB352BEC00>
           └ <module 'app.services.user_service' from 'C:\\Users\\tomas\\Documents\\Saityno Progr. Projektavimas\\StreamaBit\\app\\service...

> File "C:\Users\tomas\Documents\Saityno Progr. Projektavimas\StreamaBit\app\services\user_service.py", line 138, in remove_user
    shared_crud.commit(db)
    │           │      └ <sqlalchemy.orm.session.Session object at 0x000001EB33AA1710>
    │           └ <function commit at 0x000001EB352BEA20>
    └ <module 'app.crud.shared_crud' from 'C:\\Users\\tomas\\Documents\\Saityno Progr. Projektavimas\\StreamaBit\\app\\crud\\shared...

  File "C:\Users\tomas\Documents\Saityno Progr. Projektavimas\StreamaBit\app\crud\shared_crud.py", line 7, in commit
    return db.commit()
           │  └ <function Session.commit at 0x000001EB34EA99E0>
           └ <sqlalchemy.orm.session.Session object at 0x000001EB33AA1710>

  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\session.py", line 2028, in commit
    trans.commit(_to_root=True)
    │     └ <function SessionTransaction.commit at 0x000001EB34EA8AE0>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x000001EB351A4A00>
  File "<string>", line 2, in commit
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                │  │      │      └ {'_to_root': True}
                │  │      └ ()
                │  └ <sqlalchemy.orm.session.SessionTransaction object at 0x000001EB351A4A00>
                └ <function SessionTransaction.commit at 0x000001EB34EA8900>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\session.py", line 1313, in commit
    self._prepare_impl()
    │    └ <function SessionTransaction._prepare_impl at 0x000001EB34EA87C0>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x000001EB351A4A00>
  File "<string>", line 2, in _prepare_impl
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                │  │      │      └ {}
                │  │      └ ()
                │  └ <sqlalchemy.orm.session.SessionTransaction object at 0x000001EB351A4A00>
                └ <function SessionTransaction._prepare_impl at 0x000001EB34EA8720>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\session.py", line 1288, in _prepare_impl
    self.session.flush()
    │    │       └ <function Session.flush at 0x000001EB34EB4900>
    │    └ <sqlalchemy.orm.session.Session object at 0x000001EB33AA1710>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x000001EB351A4A00>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\session.py", line 4352, in flush
    self._flush(objects)
    │    │      └ None
    │    └ <function Session._flush at 0x000001EB34EB4AE0>
    └ <sqlalchemy.orm.session.Session object at 0x000001EB33AA1710>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\session.py", line 4487, in _flush
    with util.safe_reraise():
         │    └ <class 'sqlalchemy.util.langhelpers.safe_reraise'>
         └ <module 'sqlalchemy.util' from 'C:\\Users\\tomas\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\site-packages\\sqlalchemy...
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
          │         │              └ <traceback object at 0x000001EB368578C0>
          │         └ <method 'with_traceback' of 'BaseException' objects>
          └ IntegrityError('(psycopg2.errors.NotNullViolation) null value in column "fk_user_id" of relation "user_session" violates not-...
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\session.py", line 4448, in _flush
    flush_context.execute()
    │             └ <function UOWTransaction.execute at 0x000001EB34E993A0>
    └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x000001EB36317390>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
    │   │       └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x000001EB36317390>
    │   └ <function SaveUpdateAll.execute at 0x000001EB34E99EE0>
    └ SaveUpdateAll(Mapper[UserSession(user_session)])
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    │    │         │               └ <function save_obj at 0x000001EB34E45A80>
    │    │         └ <module 'sqlalchemy.orm.persistence' from 'C:\\Users\\tomas\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\site-packages\...
    │    └ <module 'sqlalchemy.util.preloaded' from 'C:\\Users\\tomas\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\site-packages\\...
    └ <module 'sqlalchemy.util' from 'C:\\Users\\tomas\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\site-packages\\sqlalchemy...
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\persistence.py", line 85, in save_obj
    _emit_update_statements(
    └ <function _emit_update_statements at 0x000001EB34E900E0>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\orm\persistence.py", line 912, in _emit_update_statements
    c = connection.execute(
        │          └ <function Connection.execute at 0x000001EB34B18360>
        └ <sqlalchemy.engine.base.Connection object at 0x000001EB36807910>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\engine\base.py", line 1418, in execute
    return meth(
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.dml.Update object at 0x000001EB36856E10>>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\sql\elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x000001EB34B18680>
           └ <sqlalchemy.engine.base.Connection object at 0x000001EB36807910>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\engine\base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x000001EB34B18860>
          └ <sqlalchemy.engine.base.Connection object at 0x000001EB36807910>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\engine\base.py", line 1846, in _execute_context
    return self._exec_single_context(
           │    └ <function Connection._exec_single_context at 0x000001EB34B18900>
           └ <sqlalchemy.engine.base.Connection object at 0x000001EB36807910>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\engine\base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x000001EB34B18B80>
    └ <sqlalchemy.engine.base.Connection object at 0x000001EB36807910>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\engine\base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
          │                    │              │                 └ NotNullViolation('null value in column "fk_user_id" of relation "user_session" violates not-null constraint\nDETAIL:  Failing...
          │                    │              └ (<class 'psycopg2.errors.NotNullViolation'>, NotNullViolation('null value in column "fk_user_id" of relation "user_session" v...
          │                    └ <method 'with_traceback' of 'BaseException' objects>
          └ IntegrityError('(psycopg2.errors.NotNullViolation) null value in column "fk_user_id" of relation "user_session" violates not-...
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x000001EB34BDC360>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x000001EB34FA44D0>
    └ <sqlalchemy.engine.base.Connection object at 0x000001EB36807910>
  File "C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\site-packages\sqlalchemy\engine\default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'fk_user_id': None, 'user_session_session_id': 15}
    │      │       └ 'UPDATE user_session SET fk_user_id=%(fk_user_id)s WHERE user_session.session_id = %(user_session_session_id)s'
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x000001EB368589E0; closed: -1>

sqlalchemy.exc.IntegrityError: (psycopg2.errors.NotNullViolation) null value in column "fk_user_id" of relation "user_session" violates not-null constraint
DETAIL:  Failing row contains (15, 2024-11-06 13:16:04.68704+02, 127.0.0.1, null).

[SQL: UPDATE user_session SET fk_user_id=%(fk_user_id)s WHERE user_session.session_id = %(user_session_session_id)s]
[parameters: {'fk_user_id': None, 'user_session_session_id': 15}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
